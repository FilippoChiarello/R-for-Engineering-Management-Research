<document>

<filing_date>
2018-07-12
</filing_date>

<publication_date>
2020-07-14
</publication_date>

<priority_date>
2018-03-21
</priority_date>

<ipc_classes>
G06K9/62
</ipc_classes>

<assignee>
MEGVII (BEIJING) TECHNOLOGY COMPANY
</assignee>

<inventors>
ZHANG, XIANGYU
HE, YIHUI
</inventors>

<docdb_family_id>
64326103
</docdb_family_id>

<title>
Image processing method and apparatus, and computer-readable storage medium
</title>

<abstract>
Provided are neural network-based image processing method and apparatus, and a computer-readable storage medium. The image processing method includes: inputting an image into an optimized neural network; extracting, by the optimized neural network, image features of the image; and outputting the image features, wherein the optimized neural network is obtained by performing a first optimization process on at least one sub-layer in a pre-trained initial neural network, each sub-layer of the at least one sub-layer includes a convolutional layer, and the first optimization process comprises: for each sub-layer of the at least one sub-layer, determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized.
</abstract>

<claims>
1. An image processing method, comprising: inputting an image into an optimized neural network; extracting, by the optimized neural network, image features of the image; and outputting the image features, wherein the optimized neural network is obtained by performing a first optimization process on at least one sub-layer in a pre-trained initial neural network, each sub-layer of the at least one sub-layer includes a convolutional layer, and the first optimization process comprises: for each sub-layer of the at least one sub-layer, determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized.
2. The image processing method as claimed in claim 1, wherein the optimized neural network is obtained by performing the first optimization process on the at least one sub-layer in the initial neural network and performing a second optimization process on a previous sub-layer of each sub-layer of the at least one sub-layer, the second optimization process comprises: removing one or more filters corresponding to the removed one or more channels from the previous sub-layer of each sub-layer.
3. The image processing method as claimed in claim 1, wherein determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized comprises: selecting the one or more channels to be removed from the filter of the convolutional layer by using the following Expression (1) and optimizing parameters of the remaining channels, where N represents the number of samples for optimization, Y represents original output features of each sub-layer of the at least one sub-layer, and c represents the number of original channels for input features of each sub-layer of the at least one sub-layer, c′ represents a predetermined threshold, β represents a mask vector for channel removing, Xi represents an input feature on an i-th channel, and Wi represents a parameter of the i-th channel in the filter.
4. The image processing method as claimed in claim 1, wherein determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized comprises: determining the one or more channels to be removed from the filter of the convolutional layer based on the sparse least squares and removing said one or more channels; and optimizing parameters of remaining channels in the filter of the convolutional layer by using the least squares, so that error of output features of each optimized sub-layer is minimized.
5. The image processing method as claimed in claim 4, wherein determining the one or more channels to be removed from the filter of the convolutional layer based on the sparse least squares and removing said one or more channels comprises: selecting the one or more channels to be removed from the filter of each convolutional layer by using the following Expression (2)′, optimizing parameters of remaining channels in the filter of the convolutional layer by using the least squares, so that error of output features of each optimized sub-layer is minimized comprises: optimizing parameters of remaining channels in the filter of each convolutional layer by using the following Expression (3)′, where N represents the number of samples for optimization, Y represents original output features of each sub-layer of the at least one sub-layer, c represents the number of original channels for input features of each sub-layer of the at least one sub-layer, c′ represents a predetermined threshold, β represents a mask vector for channel removing, Xi represents an input feature on an i-th channel, Wi represents a parameter of the i-th channel in the filter, and λ represents a penalty coefficient of the mask vector for channel removing, X′=[β1X1 β2X2 . . . βiXi . . . βcXc]i W′=[W1 W2 . . . Wi . . . Wc]i Zi=XiWiT.
6. The image processing method as claimed in claim 1, wherein the optimized neural network is obtained by performing the first optimization process on a plurality of sub-layers in the initial neural network, and the error is obtained by performing computation according to original output features of the convolutional layer and output features of the optimized convolutional layer.
7. The image processing method as claimed in claim 6, wherein performing the first optimization process on a plurality of sub-layers in the initial neural network so that error of optimized output features and original output features of the plurality of sub-layers in the initial neural network is minimized may be expressed as satisfying the following Expression (4): where N represents the number of samples for optimization, Y′ represents a matrix of original output features of each sub-layer of the plurality of sub-layers, c represents the number of original channels for input features of each sub-layer of the plurality of sub-layers, c′ represents a predetermined threshold, β represents a mask vector for channel removing, Xi represents an input feature on an i-th channel, and Wi represents a parameter of the i-th channel in the filter, wherein the one or more channels to be removed from the filter of each sub-layer of the plurality of sub-layers are determined by determining the β satisfying Expression (4).
8. The image processing method as claimed in claim 1, wherein the initial neural network is a multi-path neural network that includes at least one computation block, each computation block includes a first path and a second path, the first path includes a plurality of convolutional layers cascaded, the second path is a path for linking input features of a first convolutional layer in the first path and output features of a last convolutional layer in the first path, the at least one sub-layer is a convolutional layer other than the first convolutional layer and the last convolutional layer in each computation block in the multi-path neural network.
9. The image processing method as claimed in claim 8, wherein the optimized neural network is obtained by performing the first optimization process on the at least one sub-layer in the multi-path neural network, and setting a sampler before a first convolutional layer of each computation block, the sampler is used to sample input features of each computation block to filter channels for input features of the first convolutional layer.
10. The image processing method as claimed in claim 8, wherein the optimized neural network is obtained by performing the first optimization process on the at least one sub-layer in the multi-path neural network and performing a third optimization process on a last convolutional layer of each computation block, the third optimization process comprises: determining the one or more channels to be removed from the filter of the last convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the last convolutional layer, so that error of output features of each computation block is minimized.
11. The image processing method as claimed in claim 2, further comprising: collecting and updating status information of the neural network; generating a plurality of candidate values; optimizing the neural network to determine speed-up ratios and accuracy for optimization corresponding to the plurality of candidate values; and selecting a candidate value having the optimal acceleration ratio and accuracy for optimization from among the plurality of candidate values as the predetermined threshold.
12. The image processing method as claimed in claim 1, wherein said each sub-layer further includes a non-linear activation layer connected behind the convolutional layer, and the first optimization process comprises: for each sub-layer of the at least one sub-layer, determining the one or more channels to be removed from the filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of the non-linear activation layer of each sub-layer optimized is minimized.
13. The image processing method as claimed in claim 12, wherein error of output features of the non-linear activation layer of each sub-layer optimized being minimized comprises: selecting the one or more channels to be removed from the filter of each convolutional layer by using the following Expression (5), where N represents the number of samples for optimization, Y represents original output features of said each sub-layer, c represents the number of original channels for input features of said each sub-layer, c′ represents a predetermined threshold, β represents a mask vector for channel removing, Xi represents an input feature on an i-th channel, Wi represents a parameter of the i-th channel in the filter, and ƒ represents a non-linear activation function.
14. The image processing method as claimed in claim 13, wherein solving Expression (5) is equivalent to solving the following Expression (6): where U=Σi=1cβiXiWiT, Expression (6) containing no non-linear activation function is solved by fixing U, the one or more channels to be removed from the filter of each convolutional layer are determined by determining the β that satisfies Expression (6).
15. The image processing method as claimed in claim 13, wherein solving Expression (5) is equivalent to solving the following Expression (7): where U=Σi=1cβiXiWiT, and U is solved by fixing β and W.
16. An image processing apparatus, comprising: a memory for storing computer-readable instructions; and a processor for executing the computer-readable instructions to cause the image processing apparatus to perform an image processing method, said method comprising: inputting an image into an optimized neural network; extracting, by the optimized neural network, image features of the image; and outputting the image features, wherein the optimized neural network is obtained by performing a first optimization process on at least one sub-layer in a pre-trained initial neural network, each sub-layer of the at least one sub-layer includes a convolutional layer, and the first optimization process comprises: for each sub-layer of the at least one sub-layer, determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized.
17. The image processing apparatus as claimed in claim 16, wherein the optimized neural network is obtained by performing the first optimization process on the at least one sub-layer in the initial neural network and performing a second optimization process on a previous sub-layer of each sub-layer of the at least one sub-layer, the second optimization process comprises: removing one or more filters corresponding to the removed one or more channels from the previous sub-layer of each sub-layer.
18. A computer-readable non-transitory storage medium for storing computer-readable instructions capable of, when being executed by a computer, causing the computer to perform an image processing method comprising: inputting an image into an optimized neural network; extracting, by the optimized neural network, image features of the image; and outputting the image features, wherein the optimized neural network is obtained by performing a first optimization process on at least one sub-layer in a pre-trained initial neural network, each sub-layer of the at least one sub-layer includes a convolutional layer, and the first optimization process comprises: for each sub-layer of the at least one sub-layer, determining one or more channels to be removed from a filter of the convolutional layer and removing said one or more channels, and optimizing parameters of remaining channels in the filter of the convolutional layer, so that error of output features of each optimized sub-layer is minimized.
19. The computer readable non-transitory storage medium as claimed in claim 18, wherein the optimized neural network is obtained by performing the first optimization process on the at least one sub-layer in the initial neural network and performing a second optimization process on a previous sub-layer of each sub-layer of the at least one sub-layer, the second optimization process comprises: removing one or more filters corresponding to the removed one or more channels from the previous sub-layer of each sub-layer.
</claims>
</document>
