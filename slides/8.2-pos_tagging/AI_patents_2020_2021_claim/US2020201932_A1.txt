<document>

<filing_date>
2019-12-28
</filing_date>

<publication_date>
2020-06-25
</publication_date>

<priority_date>
2019-12-28
</priority_date>

<ipc_classes>
G06F17/16,G06F9/30,G06F9/38
</ipc_classes>

<assignee>
INTEL CORPORATION
</assignee>

<inventors>
RUBANOVICH, SIMON
GRADSTEIN, AMIT
SPERBER, ZEEV
BERGER, GAVRI
KHAROUF, SAEED
YALLOUZ, JOSE
SCHNEIDER, RON
MELLER, SAGI
</inventors>

<docdb_family_id>
71098561
</docdb_family_id>

<title>
APPARATUSES, METHODS, AND SYSTEMS FOR INSTRUCTIONS OF A MATRIX OPERATIONS ACCELERATOR
</title>

<abstract>
Systems, methods, and apparatuses relating to a matrix operations accelerator are described. In one embodiment, a processor includes a matrix operations accelerator circuit that includes a two-dimensional grid of fused multiply accumulate circuits that is switchable to a scheduling mode for execution of a decoded single instruction where the matrix operations accelerator circuit loads a first buffer of the two-dimensional grid of fused multiply accumulate circuits from a first plurality of registers that represents a first input two-dimensional matrix, checks if a second buffer of the two-dimensional grid of fused multiply accumulate circuits stores an immediately prior input two-dimension matrix that is the same as a second input two-dimensional matrix from a second plurality of registers that represents the first input two-dimensional matrix, and when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of a previous instruction, that is the same as the second input two-dimensional matrix: prevents reclamation of the second buffer between execution of the previous instruction and the decoded single instruction, performs an operation on the first input two-dimensional matrix from the first buffer and the immediately prior input two-dimension matrix from the second buffer to produce a resultant, and stores the resultant in resultant storage, and when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix: loads the second input two-dimensional matrix into the second buffer of the two-dimensional grid of fused multiply accumulate circuits, performs the operation on the first input two-dimensional matrix from the first buffer and the second input two-dimension matrix from the second buffer to produce a resultant, and stores the resultant in the resultant storage.
</abstract>

<claims>
1. An apparatus comprising: a matrix operations accelerator circuit comprising a two-dimensional grid of fused multiply accumulate circuits; a first plurality of registers that represents a first input two-dimensional matrix coupled to the matrix operations accelerator circuit; a second plurality of registers that represents a second input two-dimensional matrix coupled to the matrix operations accelerator circuit; a decoder, of a hardware processor core coupled to the matrix operations accelerator circuit, to decode a single instruction into a decoded single instruction, the single instruction including a field that identifies a resultant storage; and an execution circuit of the hardware processor core to execute the decoded single instruction to: load a first buffer of the two-dimensional grid of fused multiply accumulate circuits with the first input two-dimensional matrix from the first plurality of registers, check if a second buffer of the two-dimensional grid of fused multiply accumulate circuits stores an immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix, when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of a previous instruction, that is the same as the second input two-dimensional matrix: prevent reclamation of the second buffer between execution of the previous instruction and the decoded single instruction, perform an operation on the first input two-dimensional matrix from the first buffer and the immediately prior input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage, and when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix: load the second input two-dimensional matrix into the second buffer of the two-dimensional grid of fused multiply accumulate circuits, perform the operation on the first input two-dimensional matrix from the first buffer and the second input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage.
2. The apparatus of claim 1, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, the matrix operations accelerator circuit is to begin reclamation of the second buffer between execution of the previous instruction and the decoded single instruction.
3. The apparatus of claim 1, wherein the matrix operations accelerator circuit assigns an identification value for each plurality of registers that represents an input two-dimensional matrix, and the check if the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix comprises comparing respective identification values for corresponding input two-dimensional matrices from the previous instruction and the single instruction.
4. The apparatus of claim 3, wherein the matrix operations accelerator circuit is to assign a different identification value to the second plurality of registers to store an input two-dimensional matrix of a next instruction.
5. The apparatus of claim 1, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, the matrix operations accelerator circuit does not load the second buffer of the two-dimensional grid of fused multiply accumulate circuits during execution of the decoded single instruction.
6. The apparatus of claim 1, wherein the resultant storage is a third plurality of registers that represents at least one output two-dimensional matrix formed by execution of the decoded single instruction.
7. The apparatus of claim 1, where the operation comprises transmitting a respective output of each of a first proper subset of fused multiply accumulate circuits of the two-dimensional grid downstream to a respective input of each of a second proper subset of fused multiply accumulate circuits of the two-dimensional grid to form the resultant.
8. The apparatus of claim 7, wherein the first proper subset of fused multiply accumulate circuits is one of a row or a column of the two-dimensional grid of fused multiply accumulate circuits and the second proper subset of fused multiply accumulate circuits is another of the one of the row or the column of the two-dimensional grid of fused multiply accumulate circuits.
9. A method comprising: decoding, with a decoder of a hardware processor core, a single instruction into a decoded single instruction, wherein the hardware processor core is coupled to a matrix operations accelerator circuit comprising a two-dimensional grid of fused multiply accumulate circuits, the matrix operations accelerator circuit is coupled to a first plurality of registers that represents a first input two-dimensional matrix and a second plurality of registers that represents a second input two-dimensional matrix, and the single instruction includes a field that identifies a resultant storage; and executing the decoded single instruction with an execution circuit of the hardware processor core to: load a first buffer of the two-dimensional grid of fused multiply accumulate circuits with the first input two-dimensional matrix from the first plurality of registers, check if a second buffer of the two-dimensional grid of fused multiply accumulate circuits stores an immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix, when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of a previous instruction, that is the same as the second input two-dimensional matrix: prevent reclamation of the second buffer between execution of the previous instruction and the decoded single instruction, perform an operation on the first input two-dimensional matrix from the first buffer and the immediately prior input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage, and when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix: load the second input two-dimensional matrix into the second buffer of the two-dimensional grid of fused multiply accumulate circuits, perform the operation on the first input two-dimensional matrix from the first buffer and the second input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage.
10. The method of claim 9, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, further comprising beginning reclamation of the second buffer between execution of the previous instruction and the decoded single instruction.
11. The method of claim 9, further comprising assigning an identification value for each plurality of registers that represents an input two-dimensional matrix, and the check if the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix comprises comparing respective identification values for corresponding input two-dimensional matrices from the previous instruction and the single instruction.
12. The method of claim 11, further comprising assigning a different identification value to the second plurality of registers to store an input two-dimensional matrix of a next instruction.
13. The method of claim 9, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, further comprising not loading the second buffer of the two-dimensional grid of fused multiply accumulate circuits during execution of the decoded single instruction.
14. The method of claim 9, wherein the resultant storage is a third plurality of registers that represents at least one output two-dimensional matrix formed by execution of the decoded single instruction.
15. The method of claim 9, where the operation comprises transmitting a respective output of each of a first proper subset of fused multiply accumulate circuits of the two-dimensional grid downstream to a respective input of each of a second proper subset of fused multiply accumulate circuits of the two-dimensional grid to form the resultant.
16. The method of claim 15, wherein the first proper subset of fused multiply accumulate circuits is one of a row or a column of the two-dimensional grid of fused multiply accumulate circuits and the second proper subset of fused multiply accumulate circuits is another of the one of the row or the column of the two-dimensional grid of fused multiply accumulate circuits.
17. A non-transitory machine readable medium that stores code that when executed by a machine causes the machine to perform a method comprising: decoding, with a decoder of a hardware processor core, a single instruction into a decoded single instruction, wherein the hardware processor core is coupled to a matrix operations accelerator circuit comprising a two-dimensional grid of fused multiply accumulate circuits, the matrix operations accelerator circuit is coupled to a first plurality of registers that represents a first input two-dimensional matrix and a second plurality of registers that represents a second input two-dimensional matrix, and the single instruction includes a field that identifies a resultant storage; and executing the decoded single instruction with an execution circuit of the hardware processor core to: load a first buffer of the two-dimensional grid of fused multiply accumulate circuits with the first input two-dimensional matrix from the first plurality of registers, check if a second buffer of the two-dimensional grid of fused multiply accumulate circuits stores an immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix, when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of a previous instruction, that is the same as the second input two-dimensional matrix: prevent reclamation of the second buffer between execution of the previous instruction and the decoded single instruction, perform an operation on the first input two-dimensional matrix from the first buffer and the immediately prior input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage, and when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix: load the second input two-dimensional matrix into the second buffer of the two-dimensional grid of fused multiply accumulate circuits, perform the operation on the first input two-dimensional matrix from the first buffer and the second input two-dimension matrix from the second buffer to produce a resultant, and store the resultant in the resultant storage.
18. The non-transitory machine readable medium of claim 17, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits does not store the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, further comprising beginning reclamation of the second buffer between execution of the previous instruction and the decoded single instruction.
19. The non-transitory machine readable medium of claim 17, further comprising assigning an identification value for each plurality of registers that represents an input two-dimensional matrix, and the check if the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix that is the same as the second input two-dimensional matrix comprises comparing respective identification values for corresponding input two-dimensional matrices from the previous instruction and the single instruction.
20. The non-transitory machine readable medium of claim 19, further comprising assigning a different identification value to the second plurality of registers to store an input two-dimensional matrix of a next instruction.
21. The non-transitory machine readable medium of claim 17, wherein when the second buffer of the two-dimensional grid of fused multiply accumulate circuits stores the immediately prior input two-dimension matrix, from execution of the previous instruction, that is the same as the second input two-dimensional matrix, further comprising not loading the second buffer of the two-dimensional grid of fused multiply accumulate circuits during execution of the decoded single instruction.
22. The non-transitory machine readable medium of claim 17, wherein the resultant storage is a third plurality of registers that represents at least one output two-dimensional matrix formed by execution of the decoded single instruction.
23. The non-transitory machine readable medium of claim 17, where the operation comprises transmitting a respective output of each of a first proper subset of fused multiply accumulate circuits of the two-dimensional grid downstream to a respective input of each of a second proper subset of fused multiply accumulate circuits of the two-dimensional grid to form the resultant.
24. The non-transitory machine readable medium of claim 23, wherein the first proper subset of fused multiply accumulate circuits is one of a row or a column of the two-dimensional grid of fused multiply accumulate circuits and the second proper subset of fused multiply accumulate circuits is another of the one of the row or the column of the two-dimensional grid of fused multiply accumulate circuits.
</claims>
</document>
