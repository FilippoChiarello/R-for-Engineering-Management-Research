<document>

<filing_date>
2020-04-29
</filing_date>

<publication_date>
2020-08-13
</publication_date>

<priority_date>
2018-06-13
</priority_date>

<ipc_classes>
G06F16/22,G06N3/08
</ipc_classes>

<assignee>
SHENZHEN SENSETIME TECHNOLOGY COMPANY
</assignee>

<inventors>
LUO, PING
WANG, XINJIANG
WU, LINGYUN
PENG, ZHANGLIN
REN, JIAMIN
ZHANG, RUIMAO
</inventors>

<docdb_family_id>
64419572
</docdb_family_id>

<title>
NORMALIZATION METHOD AND APPARATUS FOR DEEP NEURAL NETWORK, AND STORAGE MEDIA
</title>

<abstract>
Embodiments of the present disclosure disclose normalization methods and apparatuses for a deep neural network, devices, and storage media. The method includes: inputting an input data set into a deep neural network, the input data set including at least one piece of input data; normalizing a feature map set output by means of a network layer in the deep neural network from at least one dimension to obtain at least one dimension variance and at least one dimension mean; and determining a normalized target feature map set based on the at least one dimension variance and the at least one dimension mean. Based on the embodiments of the present disclosure, normalization is performed along at least one dimension so that statistics information of each dimension of a normalization operation is covered, thereby ensuring good robustness of statistics in each dimension without excessively depending on the batch size.
</abstract>

<claims>
1. A normalization method for a deep neural network, comprising: inputting an input data set into a deep neural network, the input data set comprising at least one piece of input data; normalizing a feature map set output by means of a network layer in the deep neural network from at least one dimension to obtain at least one dimension variance and at least one dimension mean, the feature map set comprising at least one feature map, the feature map set corresponding to at least one channel, and each channel corresponding to at least one feature map; and determining a normalized target feature map set based on the at least one dimension variance and the at least one dimension mean.
2. The method according to claim 1, wherein the dimension comprises at least one of: a spatial dimension, a channel dimension, or a batch coordinate dimension, and normalizing the feature map set output by means of the neural network layer from at least one dimension to obtain at least one dimension variance and at least one dimension mean comprises: normalizing the feature map set based on the spatial dimension to obtain a spatial dimension variance and a spatial dimension mean; and/or, normalizing the feature map set based on the channel dimension to obtain a channel dimension variance and a channel dimension mean; and/or, normalizing the feature map set based on the batch coordinate dimension to obtain a batch coordinate dimension variance and a batch coordinate dimension mean; or normalizing the feature map set based on the spatial dimension to obtain a spatial dimension variance and a spatial dimension mean; obtaining a channel dimension variance and a channel dimension mean corresponding to the channel dimension based on the spatial dimension variance and the spatial dimension mean; and obtaining a batch coordinate dimension variance and a batch coordinate dimension mean corresponding to the batch coordinate dimension based on the spatial dimension variance and the spatial dimension mean.
3. The method according to claim 2, wherein normalizing the feature map set based on the channel dimension to obtain the channel dimension variance and the channel dimension mean comprises: obtaining the channel dimension mean based on at least one feature map by using a height value and a width value of the at least one feature map in the feature map set and the number of channels corresponding to the feature map set as variables; and obtaining the channel dimension variance based on the channel dimension mean and the at least one feature map, and/or normalizing the feature map set based on the batch coordinate dimension to obtain the batch coordinate dimension variance and the batch coordinate dimension mean comprises: obtaining the batch coordinate dimension mean based on the at least one feature map by using the height value and the width value of the at least one feature map in the feature map set and the amount of input data corresponding to the input data set as variables; and obtaining the batch coordinate dimension variance based on the batch coordinate dimension mean and the at least one feature map, and/or normalizing the feature map set based on the spatial dimension to obtain the spatial dimension variance and the spatial dimension mean comprises: obtaining the spatial dimension mean based on the at least one feature map by using the height value and the width value of the at least one feature map in the feature map set as variables; and obtaining the spatial dimension variance based on the spatial dimension mean and the at least one feature map, and/or obtaining the channel dimension variance and the channel dimension mean corresponding to the channel dimension based on the spatial dimension variance and the spatial dimension mean comprises: obtaining the channel dimension mean based on the spatial dimension mean by using the number of channels corresponding to the feature map set as a variable; and obtaining the channel dimension variance based on the spatial dimension mean, the spatial dimension variance, and the channel dimension mean by using the number of channels corresponding to the feature map set as the variable, and/or obtaining the batch coordinate dimension variance and the batch coordinate dimension mean corresponding to the batch coordinate dimension based on the spatial dimension variance and the spatial dimension mean comprises: obtaining the batch coordinate dimension mean based on the spatial dimension mean by using the amount of input data corresponding to the input data set as a variable; and obtaining the batch coordinate dimension variance based on the spatial dimension mean, the spatial dimension variance, and the batch coordinate dimension mean by using the amount of input data corresponding to the input data set as the variable.
4. The method according to claim 1, wherein determining the normalized target feature map set based on the at least one dimension variance and the at least one dimension mean comprises: weighted-averaging the at least one dimension variance to obtain a normalized variance, and weighted-averaging the at least one dimension mean to obtain a normalized mean; and determining the target feature map set based on the normalized variance and the normalized mean.
5. The method according to claim 4, wherein determining the target feature map set based on the normalized variance and the normalized mean comprises: processing the feature map set based on the normalized variance, the normalized mean, a scaling parameter, and a translation parameter to obtain the target feature map set.
6. The method according to claim 1, further comprising: determining at least one data result corresponding to the input data set based on the target feature map set.
7. The method according to claim 1, wherein the input data is sample data having annotation information; and the method further comprises: training the deep neural network based on a sample data set, the sample data set comprising at least one piece of sample data.
8. The method according to claim 7, wherein the deep neural network comprises at least one network layer and at least one normalization layer; and training the deep neural network based on the sample data set comprises: inputting the sample data set into the deep neural network, and outputting a sample feature map set by means of the network layer, the sample feature map set comprising at least one sample feature map; normalizing, by means of the normalization layer, the sample feature map set from at least one dimension to obtain at least one sample dimension variance and at least one sample dimension mean; determining a normalized prediction feature map set based on the at least one sample dimension variance and the at least one sample dimension mean; determining a prediction result corresponding to the sample data based on the prediction feature map set; and adjusting parameters of the at least one network layer and parameters of the at least one normalization layer based on the prediction result and the annotation information, the parameters of the normalization layer comprise at least one of: a weight value corresponding to the dimension, a scaling parameter, or a translation parameter, and the weight value comprises at least one of: a spatial dimension weight value, a channel dimension weight value, or a batch coordinate dimension weight value.
9. The method according to claim 8, wherein normalizing, by means of the normalization layer, the sample feature map set from at least one dimension to obtain at least one sample dimension variance and at least one sample dimension mean comprises: normalizing the sample feature map set based on the spatial dimension to obtain a sample spatial dimension variance and a sample spatial dimension mean; and/or, normalizing the sample feature map set based on the channel dimension to obtain a sample channel dimension variance and a sample channel dimension mean; and/or, normalizing the sample feature map set based on the batch coordinate dimension to obtain a sample batch coordinate dimension variance and a sample batch coordinate dimension mean, or normalizing the sample feature map set based on the spatial dimension to obtain a sample spatial dimension variance and a sample spatial dimension mean; obtaining a sample channel dimension variance and a sample channel dimension mean corresponding to the channel dimension based on the sample spatial dimension variance and the sample spatial dimension mean; and obtaining a sample batch coordinate dimension variance and a sample batch coordinate dimension mean corresponding to the batch coordinate dimension based on the sample spatial dimension variance and the sample spatial dimension mean.
10. The method according to claim 9, wherein normalizing the sample feature map set based on the channel dimension to obtain the sample channel dimension variance and the sample channel dimension mean comprises: obtaining the sample channel dimension mean based on at least one sample feature map by using a height value and a width value of the at least one sample feature map in the sample feature map set and the number of channels corresponding to the sample feature map set as variables; and obtaining the sample channel dimension variance based on the sample channel dimension mean and the at least one sample feature map, and/or normalizing the sample feature map set based on the batch coordinate dimension to obtain the sample batch coordinate dimension variance and the sample batch coordinate dimension mean comprises: obtaining the sample batch coordinate dimension mean based on the at least one sample feature map by using the height value and the width value of the at least one sample feature map in the sample feature map set and the amount of sample data corresponding to the sample data set as variables; and obtaining the sample batch coordinate dimension variance based on the sample batch coordinate dimension mean and the at least one sample feature map, and/or normalizing the sample feature map set based on the spatial dimension to obtain the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample spatial dimension mean based on at least one sample feature map by using the height value and the width value of the at least one sample feature map in the sample feature map set as variables; and obtaining the sample spatial dimension variance based on the sample spatial dimension mean and the at least one sample feature map, and/or obtaining the sample channel dimension variance and the sample channel dimension mean corresponding to the channel dimension based on the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample channel dimension mean based on the sample spatial dimension mean by using the number of channels corresponding to the sample feature map set as a variable; and obtaining the sample channel dimension variance based on the sample spatial dimension mean, the sample spatial dimension variance, and the sample channel dimension mean by using the number of channels corresponding to the sample feature map set as the variable, and/or obtaining the sample batch coordinate dimension variance and the sample batch coordinate dimension mean corresponding to the batch coordinate dimension based on the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample batch coordinate dimension mean based on the sample spatial dimension mean by using the amount of sample data corresponding to the sample data set as a variable; and obtaining the sample batch coordinate dimension variance based on the sample spatial dimension mean, the sample spatial dimension variance, and the sample batch coordinate dimension mean by using the amount of sample data corresponding to the sample data set as the variable.
11. The method according to claim 8, wherein determining the normalized prediction feature map set based on the at least one sample dimension variance and the at least one sample dimension mean comprises: weighted-averaging the at least one sample dimension variance to obtain a sample normalized variance, and weighted-averaging the at least one sample dimension mean to obtain a sample normalized mean; and processing the sample feature map set based on the sample normalized variance, the sample normalized mean, a scaling parameter, and a translation parameter to obtain the prediction feature map set.
12. A normalization apparatus for a deep neural network, comprising: a processor; and a memory having stored thereon instructions that, when executed by the processor, cause the processor to: input an input data set into a deep neural network, the input data set comprising at least one piece of input data; normalize a feature map set output by means of a network layer in the deep neural network from at least one dimension to obtain at least one dimension variance and at least one dimension mean, the feature map set comprising at least one feature map, the feature map set corresponding to at least one channel, and each channel corresponding to at least one feature map; and determine a normalized target feature map set based on the at least one dimension variance and the at least one dimension mean.
13. The apparatus according to claim 12, wherein the dimension comprises at least one of: a spatial dimension, a channel dimension, or a batch coordinate dimension, and normalizing the feature map set output by means of the neural network layer from at least one dimension to obtain at least one dimension variance and at least one dimension mean comprises: normalizing the feature map set based on the spatial dimension to obtain a spatial dimension variance and a spatial dimension mean; and/or, normalizing the feature map set based on the channel dimension to obtain a channel dimension variance and a channel dimension mean; and/or, normalizing the feature map set based on the batch coordinate dimension to obtain a batch coordinate dimension variance and a batch coordinate dimension mean; or normalizing the feature map set based on the spatial dimension to obtain a spatial dimension variance and a spatial dimension mean; obtaining a channel dimension variance and a channel dimension mean corresponding to the channel dimension based on the spatial dimension variance and the spatial dimension mean; and obtaining a batch coordinate dimension variance and a batch coordinate dimension mean corresponding to the batch coordinate dimension based on the spatial dimension variance and the spatial dimension mean.
14. The apparatus according to claim 13, wherein normalizing the feature map set based on the channel dimension to obtain the channel dimension variance and the channel dimension mean comprises: obtaining the channel dimension mean based on at least one feature map by using a height value and a width value of the at least one feature map in the feature map set and the number of channels corresponding to the feature map set as variables; and obtaining the channel dimension variance based on the channel dimension mean and the at least one feature map, and/or normalizing the feature map set based on the batch coordinate dimension to obtain the batch coordinate dimension variance and the batch coordinate dimension mean comprises: obtaining the batch coordinate dimension mean based on the at least one feature map by using the height value and the width value of the at least one feature map in the feature map set and the amount of input data corresponding to the input data set as variables; and obtaining the batch coordinate dimension variance based on the batch coordinate dimension mean and the at least one feature map, and/or normalizing the feature map set based on the spatial dimension to obtain the spatial dimension variance and the spatial dimension mean comprises: obtaining the spatial dimension mean based on the at least one feature map by using the height value and the width value of the at least one feature map in the feature map set as variables; and obtaining the spatial dimension variance based on the spatial dimension mean and the at least one feature map, and/or obtaining the channel dimension variance and the channel dimension mean corresponding to the channel dimension based on the spatial dimension variance and the spatial dimension mean comprises: obtaining the channel dimension mean based on the spatial dimension mean by using the number of channels corresponding to the feature map set as a variable; and obtaining the channel dimension variance based on the spatial dimension mean, the spatial dimension variance, and the channel dimension mean by using the number of channels corresponding to the feature map set as the variable, and/or obtaining the batch coordinate dimension variance and the batch coordinate dimension mean corresponding to the batch coordinate dimension based on the spatial dimension variance and the spatial dimension mean comprises: obtaining the batch coordinate dimension mean based on the spatial dimension mean by using the amount of input data corresponding to the input data set as a variable; and obtaining the batch coordinate dimension variance based on the spatial dimension mean, the spatial dimension variance, and the batch coordinate dimension mean by using the amount of input data corresponding to the input data set as the variable.
15. The apparatus according to claim 12, wherein determining the normalized target feature map set based on the at least one dimension variance and the at least one dimension mean comprises: weighted-averaging the at least one dimension variance to obtain a normalized variance, and weighted-averaging the at least one dimension mean to obtain a normalized mean; and determining the target feature map set based on the normalized variance and the normalized mean.
16. The apparatus according to claim 15, wherein determining the target feature map set based on the normalized variance and the normalized mean comprises: processing the feature map set based on the normalized variance, the normalized mean, a scaling parameter, and a translation parameter to obtain the target feature map set.
17. The apparatus according to claim 12, wherein the processor is further caused to: determine at least one data result corresponding to the input data set based on the target feature map set.
18. The apparatus according to claim 12, wherein the input data is sample data having annotation information; and the processor is further caused to: train the deep neural network based on a sample data set, the sample data set comprising at least one piece of sample data.
19. The apparatus according to claim 18, wherein the deep neural network comprises at least one network layer and at least one normalization layer; training the deep neural network based on the sample data set comprises: inputting the sample data set into the deep neural network, and outputting a sample feature map set by means of the network layer, the sample feature map set comprising at least one sample feature map; normalizing, by means of the normalization layer, the sample feature map set from at least one dimension to obtain at least one sample dimension variance and at least one sample dimension mean; determining a normalized prediction feature map set based on the at least one sample dimension variance and the at least one sample dimension mean; determining a prediction result corresponding to the sample data based on the prediction feature map set; and adjusting parameters of the at least one network layer and parameters of the at least one normalization layer based on the prediction result and the annotation information, the parameters of the normalization layer comprise at least one of: a weight value corresponding to the dimension, a scaling parameter, or a translation parameter, and the weight value comprises at least one of: a spatial dimension weight value, a channel dimension weight value, or a batch coordinate dimension weight value.
20. The apparatus according to claim 19, wherein normalizing, by means of the normalization layer, the sample feature map set from at least one dimension to obtain at least one sample dimension variance and at least one sample dimension mean comprises: normalizing the sample feature map set based on the spatial dimension to obtain a sample spatial dimension variance and a sample spatial dimension mean; and/or, normalizing the sample feature map set based on the channel dimension to obtain a sample channel dimension variance and a sample channel dimension mean; and/or, normalizing the sample feature map set based on the batch coordinate dimension to obtain a sample batch coordinate dimension variance and a sample batch coordinate dimension mean, or normalizing the sample feature map set based on the spatial dimension to obtain a sample spatial dimension variance and a sample spatial dimension mean; obtaining a sample channel dimension variance and a sample channel dimension mean corresponding to the channel dimension based on the sample spatial dimension variance and the sample spatial dimension mean; and obtaining a sample batch coordinate dimension variance and a sample batch coordinate dimension mean corresponding to the batch coordinate dimension based on the sample spatial dimension variance and the sample spatial dimension mean.
21. The apparatus according to claim 20, wherein normalizing the sample feature map set based on the channel dimension to obtain the sample channel dimension variance and the sample channel dimension mean comprises: obtaining the sample channel dimension mean based on at least one sample feature map by using a height value and a width value of the at least one sample feature map in the sample feature map set and the number of channels corresponding to the sample feature map set as variables; and obtaining the sample channel dimension variance based on the sample channel dimension mean and the at least one sample feature map, and/or normalizing the sample feature map set based on the batch coordinate dimension to obtain the sample batch coordinate dimension variance and the sample batch coordinate dimension mean comprises: obtaining the sample batch coordinate dimension mean based on the at least one sample feature map by using the height value and the width value of the at least one sample feature map in the sample feature map set and the amount of sample data corresponding to the sample data set as variables; and obtaining the sample batch coordinate dimension variance based on the sample batch coordinate dimension mean and the at least one sample feature map, and/or normalizing the sample feature map set based on the spatial dimension to obtain the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample spatial dimension mean based on at least one sample feature map by using the height value and the width value of the at least one sample feature map in the sample feature map set as variables; and obtaining the sample spatial dimension variance based on the sample spatial dimension mean and the at least one sample feature map, and/or obtaining the sample channel dimension variance and the sample channel dimension mean corresponding to the channel dimension based on the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample channel dimension mean based on the sample spatial dimension mean by using the number of channels corresponding to the sample feature map set as a variable; and obtaining the sample channel dimension variance based on the sample spatial dimension mean, the sample spatial dimension variance, and the sample channel dimension mean by using the number of channels corresponding to the sample feature map set as the variable, and/or obtaining the sample batch coordinate dimension variance and the sample batch coordinate dimension mean corresponding to the batch coordinate dimension based on the sample spatial dimension variance and the sample spatial dimension mean comprises: obtaining the sample batch coordinate dimension mean based on the sample spatial dimension mean by using the amount of sample data corresponding to the sample data set as a variable; and obtaining the sample batch coordinate dimension variance based on the sample spatial dimension mean, the sample spatial dimension variance, and the sample batch coordinate dimension mean by using the amount of sample data corresponding to the sample data set as the variable.
22. The apparatus according to claim 19, wherein determining the normalized prediction feature map set based on the at least one sample dimension variance and the at least one sample dimension mean comprises: weighted-averaging the at least one sample dimension variance to obtain a sample normalized variance, and weighted-averaging the at least one sample dimension mean to obtain a sample normalized mean; and processing the sample feature map set based on the sample normalized variance, the sample normalized mean, a scaling parameter, and a translation parameter to obtain the prediction feature map set.
23. A computer readable storage medium, configured to store computer readable instructions, wherein when the instructions are executed, operations of the normalization method for a deep neural network according to claim 1 are implemented.
</claims>
</document>
