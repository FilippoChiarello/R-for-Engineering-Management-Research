<document>

<filing_date>
2020-05-27
</filing_date>

<publication_date>
2020-09-10
</publication_date>

<priority_date>
2017-11-30
</priority_date>

<ipc_classes>
G06F7/544,G06N3/04
</ipc_classes>

<assignee>
SZ DJI TECHNOLOGY COMPANY
</assignee>

<inventors>
GU, QIAN
HAN, FENG
LI PENG
</inventors>

<docdb_family_id>
63844162
</docdb_family_id>

<title>
ARITHMETIC DEVICE FOR NEURAL NETWORK, CHIP, EQUIPMENT AND RELATED METHOD
</title>

<abstract>
An arithmetic device for a neural network includes a controller and multiply-accumulate unit groups. A multiply-accumulate unit group includes a filter register and a plurality of computing units, and the filter register is connected to the plurality of computing units. The controller is configured to generate control information and transmit the control information to the plurality of computing units. The filter register is configured to cache filter weighted values of multiply-accumulate operations to be performed. The plurality of computing units is configured to cache input feature values of the multiply-accumulate operations to be performed and perform the multiply-accumulate operations on the filter weighted values and the input feature values according to received control information.
</abstract>

<claims>
1. An arithmetic device for a neural network, comprising: a controller and multiply-accumulate unit groups, wherein: a multiply-accumulate unit group includes a filter register and a plurality of computing units, and the filter register is connected to the plurality of computing units; the controller is configured to generate control information and transmit the control information to the plurality of computing units; the filter register is configured to cache filter weighted values of multiply-accumulate operations to be performed; and the plurality of computing units is configured to cache input feature values of the multiply-accumulate operations to be performed and perform the multiply-accumulate operations on the filter weighted values and the input feature values according to received control information.
2. The device according to claim 1, wherein: the control information includes a multiply-accumulate enable signal; and the plurality of computing units performs the multiply-accumulate operations on the filter weighted values and the input feature values according to the received control information, wherein the plurality of computing units performing the multiply-accumulate operations includes: performing the multiply-accumulate operations, by the plurality of computing units, on the filter weighted values and the input feature values when the multiply-accumulate enable signal is valid.
3. The device according to claim 1, wherein: the control information further includes an input feature value read address; and the plurality of computing units performs the multiply-accumulate operations on the filter weighted values and the input feature values according to the received control information, wherein the plurality of computing units performing the multiply-accumulate operations includes: according to the input feature value read address, obtaining target feature values from the input feature values and performing the multiply-accumulate operations on the target feature values and the filter weighted values by the plurality of computing units.
4. The device according to claim 1, wherein: the control information further includes a filter weighted value read address; and the plurality of computing units performs the multiply-accumulate operations on the filter weighted values and the input feature values according to the received control information, wherein the plurality of computing units performing the multiply-accumulate operations includes: according to the filter weighted value read address, obtaining target weighted values from the filter weighted values and performing the multiply-accumulate operations on the target weighted values and the input feature values by the plurality of computing units.
5. The device according to claim 3, wherein: the controller includes a first counter and a first processor; the first counter is configured to trigger a counting when the multiply-accumulate enable signal is valid, and is further configured to reset a count value when receiving a reset signal transmitted by the first processor; and the first processor is configured to determine whether a count value of the first counter is greater than a width of a filter matrix; if the count value of the first counter is not greater than the width of the filter matrix, the first processor is configured to increment the input feature value read address by 1; and if the count value of the first counter is greater than the width of the filter matrix, the first processor is configured to transmit the reset signal to the first counter and reset the input feature value read address.
6. The device according to claim 5, wherein: the controller further includes a second counter and a second processor; when the count value of the first counter is determined to be greater than the width of the filter matrix, the first processor is configured to transmit the reset signal to the first counter and transmit a triggering count signal to the second counter; the second counter is configured to trigger the counting when receiving the triggering count signal and is further configured to reset the count value when receiving a reset signal transmitted by the second processor; and the second processor is configured to determine whether a count value of the second counter is greater than a depth of the filter matrix; if the count value of the second counter is not greater than the depth of the filter matrix, the second processor is configured to increment a first read base address by one stride, and assign the input feature value read address to the first read base address; and if the count value of the second counter is greater than the depth of the filter matrix, the second processor is configured to transmit the reset signal to the second counter, and reset the input feature value read address and the first read base address.
7. The device according to claim 5, wherein: when the count value of the first counter is determined to be greater than the width of the filter matrix, the first processor is configured to transmit the reset signal to the first counter and increment a second read base address by one stride, and is configured to determine whether a value of the second read base address is greater than a preset value; if the value of the second read base address is not greater than the preset value, the first processor is configured to assign the input feature value read address to the second read base address; and if the value of the second read base address is greater than the preset value, the first processor is configured to reset the input feature value read address and the second read base address, wherein: the preset value is determined according to the width of the filter matrix, a width of the input feature matrix, and a width of the register for caching the input feature values.
8. The device according to claim 6, wherein: the controller further includes a third processor; and a third counter is configured to trigger the counting when receiving the triggering count signal and is further configured to reset the count value when receiving the reset signal; when the count value of the second counter is determined to be greater than a depth of the input feature matrix, the second processor is configured to transmit the reset signal to the second counter and transmit the triggering count signal to the third counter; and after resetting the first read base address and assigning the second read base address to the first read base address, the second processor is configured to increment the second read base address by strides having a quantity equal to a count value of the third counter, and is further configured to determine whether a value of the second read base address is greater than a preset value, if the value of the second read base address is not greater than the preset value, the second processor is configured to assign the input feature value read address to the second read base address, and if the value of the second read base address is greater than the preset value, the second processor is configure to reset the input feature value read address, the second read base address and the third counter; and when the count value of the second counter is determined to be not greater than the depth of the input feature matrix, the second processor is configured to increment the first read base address by one stride, and after assigning the second read base address to the first read base address, the second processor is configured to increment the second read base address by the strides having the quantity equal to the count value of the third counter and is configured to assign the input feature value read address to the second read base address, wherein: the preset value is determined according to the width of the filter matrix, a width of the input feature matrix, and a storage depth of the register for caching the input feature values.
9. The device according to claim 6, wherein: the controller further includes a sixth counter; when the count value of the first counter is determined to be greater than the width of the filter matrix, the first processor is configured to transmit the reset signal to the first counter and transmit the triggering count signal to the sixth counter; the sixth counter is configured to trigger the counting when receiving the triggering count signal and is further configured to reset the count value when receiving the reset signal; and the first processor is further configured to determine whether a value of the sixth counter is greater than the depth of the filter matrix; if the value of the sixth counter is not greater than the depth of the filter matrix, the first processor is configured to assign the input feature value read address to the first read base address; and if the value of the sixth counter is greater than the depth of the filter matrix, the first processor is configured to transmit the reset signal to the sixth counter and is further configured to transmit the triggering count signal to the second counter.
10. The device according to claim 4, wherein: the controller includes a fourth counter and a third processor; the fourth counter is configured to trigger the counting when the multiply-accumulate enable signal is valid and is further configured to reset the count value after receiving a reset signal transmitted by the third processor; and the third processor is configured to determine whether a count value of the fourth counter is greater than the width of the filter matrix; if the count value of the fourth counter is not greater than the width of the filter matrix, the third processor is configured to increment the filter weighted value read address by 1; and if the count value of the fourth counter is greater than the width of the filter matrix, the third processor is configured to transmit a reset signal to the fourth counter and is further configured to reset the filter weighted value read address.
11. The device according to claim 10, wherein: the controller further includes a fifth counter and a fourth processor; when the count value of the fourth counter is determined to be greater than the width of the filter matrix, the third processor is configured to transmit the reset signal to the fourth counter and is further configured to transmit the triggering count signal to the fifth counter; the fifth counter is configured to trigger the counting when receiving the triggering count signal and is further configured to reset the count value when receiving a reset signal transmitted by the fourth processor; and the fourth processor is configured to determine whether a count value of the fifth counter is greater than the depth of the filter matrix; if the count value of the fifth counter is not greater than the depth of the filter matrix, the fourth processor is configured to increment the third read base address by one stride and is further configured to assign the filter weighted value read address to the third read base address; and if the count value of the fifth counter is greater than the depth of the filter matrix, the fourth processor is configured to transmit the reset signal to the fifth counter and is further configured to reset the filter weighted value read address and the third read base address.
12. The device according to claim 11, wherein: the filter register caches filter weighted values of a plurality of filter matrices; the controller further includes a seventh counter, and the seventh counter is configured to trigger the counting when receiving the triggering count signal and reset the count value when receiving the reset signal; and when the count value of the fifth counter is determined to be greater than the depth of the filter matrix, the fourth processor is configured to transmit the reset signal to the fifth counter and transmit the triggering count signal to the seventh counter; the fourth processor is further configured to determine whether a value of the seventh counter is greater than a total number of the plurality of filter matrices; if the value of the seventh counter is not greater than the total number of the plurality of filter matrices, the fourth processor is configured to assign the filter weighted value read address to a fourth read base address, where the fourth read base address is an initial cache address of the filter weighted values in the filter register in a next filter matrix of the plurality of filter matrices; and if the value of the seventh counter is greater than the total number of the plurality of filter matrices, the fourth processor is configured to transmit the reset signal to the seventh counter and is further configured to reset the filter weighted value read address, the third read base address and the fourth read base address.
13. The device according to claim 1, wherein: at least two computing units of the plurality of computing units are connected a same row bus, and the computing units connected to the same row bus are configured to receive and cache input feature values from the row bus wherein destination interface addresses match interface addresses of the computing units.
14. The device according to claim 13, wherein: the interface addresses of the computing units connected to a same filter register are different.
15. The device according to claim 13, wherein: the interface addresses of the computing units connected to the same row bus are different.
16. The device according to claim 1, wherein: the filter register is connected to a row bus and configured to cache filter weighted values from the row bus wherein destination interface addresses match interface addresses of the filter register.
17. The device according to claim 1, wherein: the arithmetic device includes a plurality of multiply-accumulate unit groups, and the plurality of computing units and the filter registers in the plurality of multiply-accumulate unit groups are connected to a same row bus.
18. The device according to claim 17, wherein: interface addresses of the plurality of computing units between different multiply-accumulate unit groups in the plurality of multiply-accumulate unit groups are same; or interface addresses of the plurality of computing units between different multiply-accumulate unit groups in the plurality of multiply-accumulate unit groups are different.
19. An arithmetic device for a neural network, comprising: a controller and a plurality of multiply-accumulate unit groups, wherein: each multiply-accumulate unit group includes computing units and a filter register connected to the computing units; the controller is configured to generate control information and transmit the control information to the computing units; each filter register is configured to cache filter weighted values of multiply-accumulate operations to be performed; and each computing unit is configured to cache input feature values of the multiply-accumulate operations to be performed and perform the multiply-accumulate operations on the filter weighted values and the input feature values according to control information transmitted by the controller, wherein: in the plurality of multiply-accumulate unit groups, computing units of a first multiply-accumulate unit group and computing units of another multiply-accumulate unit group are connected in a preset order; or computing units of a first multiply-accumulate unit group and computing units of two other multiply-accumulate unit groups are connected in a preset order; and the order connection is configured to accumulate multiply-accumulate results of the computing units connected in the preset order.
20. A chip for a neural network, comprising: an arithmetic device, and a communication interface, configured to obtain data to be processed by the arithmetic device and output arithmetic results of the arithmetic device, wherein the arithmetic device includes: a controller and multiply-accumulate unit groups, wherein: a multiply-accumulate unit group includes a filter register and a plurality of computing units, and the filter register is connected to the plurality of computing units; the controller is configured to generate control information and transmit the control information to the plurality of computing units; the filter register is configured to cache filter weighted values of multiply-accumulate operations to be performed; and the plurality of computing units is configured to cache input feature values of the multiply-accumulate operations to be performed and perform the multiply-accumulate operations on the filter weighted values and the input feature values according to received control information.
</claims>
</document>
