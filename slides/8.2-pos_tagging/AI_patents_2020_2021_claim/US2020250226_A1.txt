<document>

<filing_date>
2020-03-27
</filing_date>

<publication_date>
2020-08-06
</publication_date>

<priority_date>
2019-03-28
</priority_date>

<ipc_classes>
G06F16/583,G06K9/00,G06K9/42,G06K9/46,G06K9/62,G06N3/08
</ipc_classes>

<assignee>
BEIJING DAJIA INTERNET INFORMATION TECHNOLOGY COMPANY
</assignee>

<inventors>
LI YAN
YANG FAN
</inventors>

<docdb_family_id>
66953954
</docdb_family_id>

<title>
SIMILAR FACE RETRIEVAL METHOD, DEVICE AND STORAGE MEDIUM
</title>

<abstract>
The disclosure discloses a similar face retrieval method and device and a storage medium. The method includes: acquiring a face image to be retrieved; performing feature extraction on the face image to be retrieved based on a feature extraction model, and taking an output result of an antepenultimate layer of the feature extraction model as a first similar face feature of the face image to be retrieved; for each face image in a face database, acquiring the distance in feature space between the first similar face feature and a second similar face feature of each face image; and according to the obtained distance information, retrieving a target face image with the highest similarity to the face image to be retrieved in the face database.
</abstract>

<claims>
1. A similar face retrieval method, comprising: acquiring a face image to be retrieved; performing feature extraction on the face image to be retrieved based on a feature extraction model, wherein the feature extraction model is obtained by optimizing a trained initial model based on a triplet loss function; taking an output result of an antepenultimate layer of the feature extraction model as a first similar face feature of the face image to be retrieved; for each face image in a face database, acquiring a distance in feature space between the first similar face feature and a second similar face feature of each face image, wherein the second similar face feature is obtained by performing feature extraction on each face image based on the feature extraction model; and according to the obtained distance, retrieving a target face image with a highest similarity to the face image to be retrieved in the face database.
2. The similar face retrieval method according to claim 1, wherein training processes of the feature extraction model comprise: acquiring first training sample images marked with classification information; preprocessing the first training sample images; performing model training according to the preprocessed first training sample images till model convergence to obtain an initial model; optimizing the initial model by means of a stochastic gradient descent algorithm to obtain the trained initial model; and optimizing the trained initial model based on the triplet loss function to obtain the feature extraction model.
3. The similar face retrieval method according to claim 2, wherein the optimizing the trained initial model based on the triplet loss function comprises: acquiring second training sample images; for an anchor face image in the second training sample images, based on the trained initial model, performing similar face retrieval in third training sample images to obtain two face images with similarity ranked in the top two, wherein the anchor face image is any one face image in the second training sample images; determining a positive sample and a negative sample in the obtained two face images, wherein a similarity between the positive sample and the anchor face image is higher than a similarity between the negative sample and the anchor face image; acquiring similar face features of all sample triplets based on the trained initial model, wherein each sample triplet comprises an anchor face image, and a positive sample and a negative sample of the anchor face image; and according to the obtained similar face features of the sample triplets, constructing the triplet loss function, and optimizing the triplet loss function by means of the stochastic gradient descent algorithm till convergence.
4. The similar face retrieval method according to claim 3, wherein a convergence condition of the triplet loss function is that a first distance is smaller than a second distance; wherein the first distance indicates a distance in feature space between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, and the second distance indicates a distance in feature space between the similar face feature of the anchor face image and a similar face feature of a negative sample.
5. The similar face retrieval method according to claim 3, wherein a formula of the triplet loss function is:
description="In-line Formulae" end="lead"?loss=max(0,∥f(xai)−f(xpi)∥22+margin−∥f(xai)−f(xni)∥22);description="In-line Formulae" end="tail"? wherein loss refers to the triplet loss function, ∥f(xai)−f(xpi)∥22 refers to an Euclidean distance between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, ∥f(xai)−f(xni)∥22 refers to an Euclidean distance between the similar face feature of the anchor face image and a similar face feature of a negative sample in the same sample triplet, margin refers to a fixed minimum interval, and i is a positive integer.
6. The similar face retrieval method according to claim 2, wherein the performing model training according to the preprocessed first training sample images till model convergence to obtain the initial model comprises: inputting the preprocessed first training sample images into a convolutional neural network with a cross entropy loss function, and obtaining a predicted classification result of the first training sample images output by the convolutional neural network; determining whether a marked classification result of the first training sample images is consistent with the predicted classification result based on the cross entropy loss function; and when the marked classification result is inconsistent with the predicted classification result, iteratively updating a weight value in the convolutional neural network till the marked classification result is consistent with the predicted classification result.
7. The similar face retrieval method according to claim 1, wherein the performing feature extraction on the face image to be retrieved based on the feature extraction model comprises: preprocessing the face image to be retrieved, wherein the preprocessing comprises at least clipping processing and alignment processing; and performing feature extraction on the preprocessed face image to be retrieved based on the feature extraction model.
8. A similar face retrieval device, comprising: a memory and at least one processor, wherein the at least one processor is configured to read and execute processor executable instructions stored in the memory to: acquire a face image to be retrieved; perform feature extraction on the face image to be retrieved based on a feature extraction model, and take an output result of an antepenultimate layer of the feature extraction model as a first similar face feature of the face image to be retrieved, wherein the feature extraction model is obtained by optimizing a trained initial model based on a triplet loss function; for each face image in a face database, acquire a distance in feature space between the first similar face feature and a second similar face feature of each face image, wherein the second similar face feature is obtained by performing feature extraction on each face image based on the feature extraction model; and according to the obtained distance, retrieve a target face image with a highest similarity to the face image to be retrieved in the face database.
9. The similar face retrieval device according to claim 8, wherein the at least one processor is further configured to read and execute the processor executable instructions stored in the memory to perform training processes of the feature extraction model by: acquiring first training sample images marked with classification information; preprocessing the first training sample images; performing model training according to the preprocessed first training sample images till model convergence to obtain an initial model; optimizing the initial model by means of a stochastic gradient descent algorithm to obtain the trained initial model; and optimizing the trained initial model based on the triplet loss function to obtain the feature extraction model.
10. The similar face retrieval device according to claim 9, wherein the at least one processor is further configured to read and execute the processor executable instructions stored in the memory to: acquire second training sample images; for an anchor face image in the second training sample images, based on the trained initial model, perform similar face retrieval in third training sample images to obtain two face images with similarity ranked in the top two, wherein the anchor face image is any one face image in the second training sample images; determine a positive sample and a negative sample in the obtained two face images, wherein a similarity between the positive sample and the anchor face image is higher than a similarity between the negative sample and the anchor face image; acquire similar face features of all sample triplets based on the trained initial model, wherein each sample triplet comprises an anchor face image, and a positive sample and a negative sample of the anchor face image; and according to the obtained similar face features of the sample triplets, construct the triplet loss function, and optimize the triplet loss function by means of the stochastic gradient descent algorithm till convergence.
11. The similar face retrieval device according to claim 10, wherein a convergence condition of the triplet loss function is that a first distance is smaller than a second distance; wherein the first distance indicates a distance in feature space between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, and the second distance indicates a distance in feature space between the similar face feature of the anchor face image and a similar face feature of a negative sample.
12. The similar face retrieval device according to claim 10, wherein a formula of the triplet loss function is:
description="In-line Formulae" end="lead"?loss=max(0,∥f(xai)−f(xpi)∥22+margin−∥f(xai)−f(xni)∥22);description="In-line Formulae" end="tail"? wherein loss refers to the triplet loss function, ∥f(xai)−f(xpi)∥22 refers to an Euclidean distance between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, ∥f(xai)−f(xni)∥22 refers to an Euclidean distance between the similar face feature of the anchor face image and a similar face feature of a negative sample in the same sample triplet, margin refers to a fixed minimum interval, and i is a positive integer.
13. The similar face retrieval device according to claim 9, wherein the at least one processor is further configured to read and execute the processor executable instructions stored in the memory to: input the preprocessed first training sample images into a convolutional neural network with a cross entropy loss function, and obtain a predicted classification result of the first training sample images output by the convolutional neural network; determine whether a marked classification result of the first training sample images is consistent with the predicted classification result based on the cross entropy loss function; and when the marked classification result is inconsistent with the predicted classification result, iteratively update a weight value in the convolutional neural network till the marked classification result is consistent with the predicted classification result.
14. The similar face retrieval device according to claim 8, wherein the at least one processor is further configured to read and execute the processor executable instructions stored in the memory to: preprocess the face image to be retrieved, wherein the preprocessing comprises at least clipping processing and alignment processing; and perform feature extraction on the preprocessed face image to be retrieved based on the feature extraction model.
15. A non-transitory computer readable storage medium, wherein when instructions in the storage medium are executed by a processor of a similar face retrieval device, the similar face retrieval device is enabled to execute a similar face retrieval method, the method comprising: acquiring a face image to be retrieved; performing feature extraction on the face image to be retrieved based on a feature extraction model, wherein the feature extraction model is obtained by optimizing a trained initial model based on a triplet loss function; taking an output result of an antepenultimate layer of the feature extraction model as a first similar face feature of the face image to be retrieved; for each face image in a face database, acquiring a distance in feature space between the first similar face feature and a second similar face feature of each face image, wherein the second similar face feature is obtained by performing feature extraction on each face image based on the feature extraction model; and according to the obtained distance, retrieving a target face image with a highest similarity to the face image to be retrieved in the face database.
16. The storage medium according to claim 15, wherein training processes of the feature extraction model comprise: acquiring first training sample images marked with classification information; preprocessing the first training sample images; performing model training according to the preprocessed first training sample images till model convergence to obtain an initial model; optimizing the initial model by means of a stochastic gradient descent algorithm to obtain the trained initial model; and optimizing the trained initial model based on the triplet loss function to obtain the feature extraction model.
17. The storage medium according to claim 16, wherein the optimizing the trained initial model based on the triplet loss function comprises: acquiring second training sample images; for an anchor face image in the second training sample images, based on the trained initial model, performing similar face retrieval in third training sample images to obtain two face images with similarity ranked in the top two, wherein the anchor face image is any one face image in the second training sample images; determining a positive sample and a negative sample in the obtained two face images, wherein a similarity between the positive sample and the anchor face image is higher than a similarity between the negative sample and the anchor face image; acquiring similar face features of all sample triplets based on the trained initial model, wherein each sample triplet comprises an anchor face image, and a positive sample and a negative sample of the anchor face image; and according to the obtained similar face features of the sample triplets, constructing the triplet loss function, and optimizing the triplet loss function by means of the stochastic gradient descent algorithm till convergence.
18. The storage medium according to claim 17, wherein a convergence condition of the triplet loss function is that a first distance is smaller than a second distance; wherein the first distance indicates a distance in feature space between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, and the second distance indicates a distance in feature space between the similar face feature of the anchor face image and a similar face feature of a negative sample.
19. The storage medium according to claim 17, wherein a formula of the triplet loss function is:
description="In-line Formulae" end="lead"?loss=max(0,∥f(xai)−f(xpi)∥22+margin−∥f(xai)−f(xni)∥22);description="In-line Formulae" end="tail"? wherein loss refers to the triplet loss function, ∥f(xai)−f(xpi)∥22 refers to an Euclidean distance between a similar face feature of an anchor face image and a similar face feature of a positive sample in a same sample triplet, ∥f(xai)−f(xni)∥22 refers to an Euclidean distance between the similar face feature of the anchor face image and a similar face feature of a negative sample in the same sample triplet, margin refers to a fixed minimum interval, and i is a positive integer.
20. The storage medium according to claim 16, wherein the performing model training according to the preprocessed first training sample images till model convergence to obtain the initial model comprises: inputting the preprocessed first training sample images into a convolutional neural network with a cross entropy loss function, and obtaining a predicted classification result of the first training sample images output by the convolutional neural network; determining whether a marked classification result of the first training sample images is consistent with the predicted classification result based on the cross entropy loss function; and when the marked classification result is inconsistent with the predicted classification result, iteratively updating a weight value in the convolutional neural network till the marked classification result is consistent with the predicted classification result.
</claims>
</document>
