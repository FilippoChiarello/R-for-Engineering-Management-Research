<document>

<filing_date>
2018-06-27
</filing_date>

<publication_date>
2020-11-03
</publication_date>

<priority_date>
2018-06-27
</priority_date>

<ipc_classes>
G01C21/32,G05D1/00,G05D1/02,G06F17/10,G06T11/20
</ipc_classes>

<assignee>
BAIDU USA
</assignee>

<inventors>
ZHANG, YAJIA
</inventors>

<docdb_family_id>
69054646
</docdb_family_id>

<title>
Reference line smoothing method using piecewise spiral curves with weighted geometry costs
</title>

<abstract>
A first reference line representing a routing line from a first location to a second location associated with an autonomous driving vehicle (ADV) is received. The first reference line is segmented into a number of reference line segments. For each of the reference line segments, a quintic polynomial function is defined to represent the reference line segment. An objective function is determined based on the quintic polynomial functions of the reference line segments. An optimization is performed on coefficients of the quintic polynomial functions in view of a set of constraints associated with the reference line segments, such that an output of the objective function reaches minimum while the constraints are satisfied. A second reference line is then generated based on the optimized parameters or coefficients of the quintic polynomial functions of the objective function. The second reference line is then utilized to plan and control the ADV.
</abstract>

<claims>
1. A computer-implemented method for operating an autonomous driving vehicle (ADV), the method comprising: processing map data to generate a plurality of points that define a reference line along an ADV route from a first location to a second location, wherein each point includes a two dimensional (2D) coordinate, each consecutive pair of points form a reference line segment along the reference line and each reference line segment is defined by a quintic polynomial function having six coefficients; initializing optimization parameters, wherein the optimization parameters include a length of each reference line segment, a 2D coordinate of each point, a direction of each reference line segment, a curvature of each reference line segment, and a curvature change rate of each reference line segment; iteratively optimizing the optimization parameters of the route such that an output of an objective function is minimized, the objective function including a summation of a) a curve length of each reference line segment, b) a square of the curvature of each reference line segment, and c) a square of the rate of change of the curvature of each reference line segment, and a set of constraints associated with the reference line segments are satisfied, and the six coefficients of each polynomial function are determined based on the direction, the curvature and the curvature rate of change at a starting point and an ending point of each respective reference line segment; and generating a smooth reference line based on the optimized parameters, wherein the smooth reference line is utilized as a reference to direct the ADV from the first location to the second location.
2. The method of claim 1, wherein the curve length of each reference line segment, the square of the curvature of the reference line segment, and the square of the rate of change of the curvature of the reference line segment are weighted.
3. The method of claim 1, wherein the objective function further comprises a summation of: a square of a derivative of the rate of change of the curvature of each reference line segment.
4. The method of claim 1, wherein optimizing the optimization parameters comprises: varying the optimization parameters to minimize the output of the objective function; evaluating whether a point deviation is within a deviation threshold, the point deviation defined by a change in the coordinate of a particular point from the initial coordinate of the particular point; and if the point deviation is beyond the deviation threshold, repeating varying the optimization parameters in a different direction and/or with a different step size as previously varied, until the output of the objective function is minimized and the point deviation is within the deviation threshold.
5. The method of claim 4, wherein the deviation threshold is a pre-determined threshold based on a reliability of, or confidence in, one or more sensors that generated the map data, where a high confidence corresponds to a small threshold.
6. The method of claim 1, wherein the optimization parameters are varied such that an output of the quintic polynomial function at a starting point of each reference line segment is similar to a direction of the ADV at the starting point of each reference line segment and an output of the quintic polynomial function at an ending point of the reference line segment is similar to a direction of the ADV at a starting point of a next reference line segment.
7. The method of claim 1, wherein the set of constraints includes a condition in which a first order derivative of the quintic polynomial function at the starting point of each reference line segment is similar to a curvature at a starting point of the reference line segment, and wherein a first order derivative of the quintic polynomial function at an ending point of the reference line segment is similar to a curvature at a starting point of a next reference line segment.
8. A non-transitory machine-readable medium having instructions stored therein, which when executed by a processor, cause the processor to perform operations, the operations comprising: processing map data to generate a plurality of points that define a reference line along an ADV route from a first location to a second location, wherein each point has a two dimensional (2D) coordinate, each consecutive pair of points form a reference line segment along the reference line and each reference line segment is defined by a quintic polynomial function having six coefficients; initializing optimization parameters, wherein the optimization parameters include a length of each reference line segment, a 2D coordinate of each point, a direction of each reference line segment, a curvature of each reference line segment, and a curvature change rate of each reference line segment; optimizing the optimization parameters of the route such that an output of an objective function is minimized, the objective function including a summation of a) a curve length of each reference line segment, b) a square of the curvature of each reference line segment, and c) a square of the rate of change of the curvature of each reference line segment, wherein each reference line segment is defined by a quintic polynomial function, a set of constraints associated with the reference line segments are satisfied, and the six coefficients of each polynomial function are determined based on the direction, the curvature and the curvature rate of change at a starting point and an ending point of each respective reference line segment; and generating a smooth reference line based on the optimized parameters, wherein the smooth reference line is utilized as a reference to direct the ADV from the first location to the second location.
9. The machine-readable medium of claim 8, wherein the curve length of each reference line segment, the square of the curvature of the reference line segment, and the square of the rate of change of the curvature of the reference line segment are weighted.
10. The machine-readable medium of claim 9, wherein the objective function includes a summation of a curve length of each reference line segment, a square of the curvature of each reference line segment, a square of the rate of change of the curvature of each reference line segment, and a derivative of the rate of change of the curvature of each reference line segment.
11. The machine-readable medium of claim 8, wherein optimizing the optimization parameters include: varying the optimization parameters to minimize the output of the objective function; evaluating whether a point deviation is within a deviation threshold, the point deviation defined by a change in the coordinate of a particular point from the initial coordinate of the particular point; and if the point deviation is beyond the deviation threshold, repeating varying the optimization parameters in a different direction and/or with a different step size as previously varied, until the output of the objective function is at a minimal value and the point deviation is within the deviation threshold.
12. The machine-readable medium of claim 11, wherein the deviation threshold is a pre-determined threshold based on the reliability of, or confidence in, one or more sensors that generated the map data, where a high confidence corresponds to a small threshold.
13. The machine-readable medium of claim 8, wherein the optimization parameters are varied such that an output of the quintic polynomial function at a starting point of each reference line segment is similar to a direction of the ADV at the starting point of each reference line segment and an output of the quintic polynomial function at an ending point of the reference line segment is similar to a direction of the ADV at a starting point of a next reference line segment.
14. The machine-readable medium of claim 8, wherein the set of constraints includes a condition in which a first order derivative of the quintic polynomial function at a starting point of each reference line segment is similar to a curvature at the starting point of the reference line segment, and wherein a first order derivative of the quintic polynomial function at an ending point of the reference line segment is similar to a curvature at a starting point of a next reference line segment.
15. A data processing system, comprising: a processor; and a memory coupled to the processor to store instructions, which when executed by the processor, cause the processor to perform operations, the operations including processing map data to generate a plurality of points that define a reference line along an ADV route from a first location to a second location, wherein each point has a two dimensional (2D) coordinate, each consecutive pair of points form a reference line segment along the reference line and each reference line segment is defined by a quintic polynomial function having six coefficients; initializing optimization parameters, wherein the optimization parameters include one or more of the following: a length of each reference line segment, a 2D coordinate of each point, a direction of each reference line segment, a curvature of each reference line segment, and a curvature change rate of each reference line segment; optimizing the optimization parameters of the route such that an output of an objective function is minimized, the objective function including a summation of a) a curve length of each reference line segment, b) a square of the curvature of each reference line segment, and c) a square of the rate of change of the curvature of each reference line segment a set of constraints associated with the reference line segments are satisfied, and the six coefficients of each polynomial function are determined based on the direction, the curvature and the curvature rate of change at a starting point and an ending point of each respective reference line segment; and generating a smooth reference line based on the optimized parameters, wherein the smooth reference line is utilized as a reference to direct the ADV from the first location to the second location.
16. The system of claim 15, wherein initializing the optimization parameters includes initializing a length of each reference line segment as the distance between consecutive points, a 2D coordinate of each point as the initially generated coordinates from map data, a direction of each reference line segment as an arctan direction between two consecutive points, the curvature of each reference line segment as zero, and the curvature change rate of each reference line as zero.
</claims>
</document>
