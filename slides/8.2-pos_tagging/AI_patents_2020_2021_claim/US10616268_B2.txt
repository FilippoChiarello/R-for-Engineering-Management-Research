<document>

<filing_date>
2016-10-12
</filing_date>

<publication_date>
2020-04-07
</publication_date>

<priority_date>
2016-01-07
</priority_date>

<ipc_classes>
G06F11/07,G06F21/55,G06F9/455,G06N20/00,G06N7/00,G06N7/08,G06N99/00,H04L29/06,H04L29/08,H04L29/14
</ipc_classes>

<assignee>
SHANGHAI MARITIME UNIVERSITY
</assignee>

<inventors>
BI, KUN
CHEN, FUMEI
HAN, DEZHI
HAN, HAOCHEN
WANG JUN
XIE, BOLIN
</inventors>

<docdb_family_id>
55719950
</docdb_family_id>

<title>
Anomaly detection method for the virtual machines in a cloud system
</title>

<abstract>
An anomaly detection method for virtual machines in a cloud system, in which an HsMM is trained by searching the state information of the normal virtual machines in the cloud system, and a corresponding algorithm is designed to detect and calculate the probabilistic logarithm probability and the Mahalanobis distance of the dynamic changing behaviors of the resources in the cloud system when each virtual machine is online. If the Mahalanobis distance value of an online virtual machine is detected being higher than the preset threshold value of the cloud system, it is suggested that the virtual machine is operating anomalously.
</abstract>

<claims>
1. An anomaly detection method for virtual machines in a cloud system, wherein, a virtual machine's state attribute information searching module searches for state attribute information of each virtual machine in the cloud system and sends the aforementioned state attribute information to an HsMM online detection module in real time for anomaly detection; the HsMM online detection module detects a virtual machine with anomalous behavior and sends the state attribute information of each anomalous virtual machine to an anomaly detection and treatment system of the virtual machines in the cloud system; the virtual machine's anomaly detection and treatment system detects any anomalous virtual machine, removes its anomaly and issues warnings to the corresponding cloud renter when its anomaly degree has not reached a preset index of the cloud system; and the detection and treatment system issues warnings to the corresponding cloud renter and shuts down the anomalous virtual machine when its anomaly degree has reached the preset index of the cloud system; wherein, the method comprises the following steps: step 1: searching a state attribute value of each virtual machine in a normal state in the cloud system through a module searching virtual machine attribute information; the normal state herein refers to the state of the virtual machine without any internal virus or external attack: step 2: taking the state attribute value of each virtual machine in tihe normal state as an observation sequence, and training an HsMM and design an HsMM online detection algorithm; step 3. searching the online state information of each virtual machine in the cloud with a module; searching the virtual machine's state attribute information in accordance with a preset time interval of the cloud system, and sending the information to the HsMM online detection module in real time; step 4: detecting, by the HsMM online detection module, which is based on an algorithm obtained from step 2, the state and behavior of each virtual machine online and calculating its probabilistic logarithm probability and the Mahalanobis distance so as to judge whether the virtual machine is anomalous; step 5: comparing the Mahalanobis distance calculated by the online behavior of each virtual machine with the preset threshold value Q of the cloud system, and judging whether the Mahalanobis distance value of the online behavior of each virtual machine is higher than the threshold value Q, and when the former is higher than the latter, turn to step 6; when the former is not higher than the latter, return to step 3; step 6: starting the anomaly detection and treatment system of the cloud system, and detecting each virtual machine whose detection result is higher than the preset threshold value Q of the cloud system; step 7: determining whether the anomaly index of each virtual machine detected in 6 is higher than a maximum preset threshold value Emax of the anomaly detection and treatment system; and when the anomaly index is equal to or higher than the maximum threshold value Emax, turn to step 8; when the anomaly index is lower than Emax, the anomaly detection and treatment system removes the anomaly and sends warnings to the corresponding cloud renter and then returns to step 3; step 8: sending, by the anomaly detection and treatment system, warnings to the corresponding cloud renter when the anomaly index of one virtual machine in the cloud system is equal to or higher than the maximum threshold value Emax and shutting down that virtual machine.
2. The anomaly detection method for the virtual machines in a cloud system of claim 1, wherein, the state attribute value of the virtual machine comprises the CPU use ratio, GPU use ratio, I/O waiting time and memory use ratio, as well as their dynamic changes over time, any state from state 1 to state 4 is the normal state of the virtual machines and state 5 and state 6 are anomalous, wherein, in state 1, the use ratio of the CPU, GPU and memory of a virtual machine is lower than 30%, and its I/O waiting time is shorter than the normal I/O waiting time; in state 2, the use ratio of one or more of the CPU, GPU and memory of a virtual machine is higher than 30% but lower than 50%, and that of the other factors is lower than 30%; and it has a second I/O waiting time which is normal; in state 3, the use ratio of one or more of the CPU, GPU and memory of a virtual machine is higher than 50% but lower than 80%, and that of other factors is lower than 50%; and it has a second I/O waiting time which is normal; in state 4, the use ratio of one of the CPU, GPU and memory of a virtual machine is higher than 80% but lower than 90%, and that of other factors is lower than 80% and their changes are normal; and it has a third I/O waiting time which is longer than the normal one; in state 5, the use ratio of one or more of the CPU, GPU and memory of a virtual machine is higher than 80% but lower than 90%, and that of other factors is lower than 80% and their changes are anomalous; and it has a third I/O waiting time and a fourth I/O waiting time which is longer than the third 1/O waiting time; in state 6, the use ratio of one or more of the CPU, GPU and memory of a virtual machine is higher than 90%, and that of others is lower than 80% and their changes are anomalous; and it has a fourth I/O waiting time.
3. The anomaly detection method for the virtual machine in the cloud system of claim 1, wherein, the HsMM is expressed by λ={S, π, A, B, P}, and each parameter is defined as follows: S is the state set of the HsMM, S={s1, s2, . . . , sG}, where sg(1≤g≤G) is the possible state of the HsMM at time t, and G is the total number of its states; π is the probability matrix of the initial state, π={πg}, πg=Pr[q1=sg], 1≤g≤G, in which, Σgπg=1; πg refers to the probability of the HsMM in the state sg at time 1, A is the state transfer probability matrix, A={agi}, agi=Pr[qt+1=si|qt=sg], 1≤g, i≤G, in which, Σi agi=1, qt is the state of HsMM at time t, agi refers to the probability of the HsMM shifting from the state sg to the state si at time t; B is the observation value probability matrix, B={bg(vk)}, bg(vk)=Pr[Ot=Vk|qt=sg], 1≤k≤K, 1≤g≤G, in which, ot refers to the observation value of the HsMM at time t, bg(vk) refers to the probability of the HsMM in the state sg at time t, and the observation value Ot=Vk, K is the maximum length of the observation sequence; P is the state sustainability probability matrix, P={pg(d); 1≤d≤D, 1≤g≤G}, pg(d)=Pr[τt=d|qt=sg] is the probability of the HsMM staying in the state sg at time t and remaining in that state until time d; wherein D is the longest time of the state sustainability.
4. The anomaly detection method for the virtual machines in a cloud system of claim 3, wherein, the process for training the HsMM by an observation sequence of the state attribute value of the virtual machines in the normal state includes: S1. calculating a forward variable αt(h)(g,d) of each virtual machine's state information observation sequence O(h)(1≤h≤H)'s, which represents the probability of the virtual machine's sustained staying in the state sg until time d when the initial t observed values o1t of arrive at the virtual machine's attribute information searching module, in which, 1≤t≤T; and the forward variable is determined based on:
description="In-line Formulae" end="lead"?αt(h)(g,d)=Pr[(o1t)h,(qt,τt)=(sg,d)] (1)description="In-line Formulae" end="tail"? in which, H is the total number of the virtual machine's state observation sequence, T* is the length of the corresponding observation sequence; S2. calculating a probabilistic logarithm probability Ph of each normal virtual machine's observation sequence corresponding to the HsMM respectively, 1≤h≤H, the probabilistic logarithm probability Ph* of the online normal virtual machine, and the probabilistic logarithm probability PH of each normal virtual machine's observation sequence corresponding to the HsMM; wherein PH is the initial probabilistic logarithm probability distribution by the probabilistic logarithmic value of the normal virtual machine:
description="In-line Formulae" end="lead"?Ph=ln(P(O(h)|λ))=ln(Σg=1GΣd=1DαT*h((g,d)) (2)description="In-line Formulae" end="tail"?
description="In-line Formulae" end="lead"?Ph*=ln(P(O(h*)|λ))=ln(Σg=1GΣd=1DαT*h*((g,d)) (3)description="In-line Formulae" end="tail"?
description="In-line Formulae" end="lead"?PH=Πh=1H ln(P(O(h)|λ))=Πh=1HPh (4)description="In-line Formulae" end="tail"? S3. calculating a mean value μ and a standard deviation σ of the initial probabilistic logarithm probability distribution PH respectively as follows:
description="In-line Formulae" end="lead"?μ=PH(5)σ=1H−1□Σh=1H□□(Ph−μ)2(6)description="In-line Formulae" end="tail"? S4. calculating a backward variable βt(h)(g,d) of the observation sequence O(h) (1≤h≤H) of each virtual machine, which represents the probability of the observation value ot+1T* when the observation value o1t tat time t arrives at the virtual machine's attribute information searching module and when the virtual machine remains in the state sg until time d, and the definition of the backward variable is shown in formula (7):
description="In-line Formulae" end="lead"?βt(h)(g,d)=Pr[(ot+1T*)h|(qt,τt)=(sg,d)] (7)description="In-line Formulae" end="tail"? S5. determining based on the forward variable αt(h)(g,d) and the backward variable βt(h)(g,d), a joint probability of the state shift ξt(h)(g,i), a joint probability of the sustained state ηt(h)(g,d), a joint probability of the state and the observation value γt(h)(g) obtained respectively by formulas (8), (9), (10):
description="In-line Formulae" end="lead"?ξt(h)(g,i)=Pr[O(h),qt−1=sg,qt=si] (8)description="In-line Formulae" end="tail"?
description="In-line Formulae" end="lead"?ηt(h)(g,d)=Pr[O(h),qt−1≠sg,qt=sg,τt=d] (9)description="In-line Formulae" end="tail"?
description="In-line Formulae" end="lead"?γt(h)=Pr[O(h),qt=sg] (10)description="In-line Formulae" end="tail"? S6. assigning an initial value to the model parameters of the HsMM, to make agi=1/(G−1), πg=1/g, pg(d)=1/D, bg(vk)=1/(G−1); and the automatic state shift probability at agg=0, and upgrade the parameters according to formulas (11)-(14); when ot=vk, δ(ot−vk=1; otherwise, δ(ot−vk)=0; S7. determining whether PH derived from S2 is a stable value; and when it is, the HsMM model parameter set λ is obtained, and the model training process ends; and when the PH derived from S2 is not stable, repeat steps S1 to S6.
5. The anomaly detection method for the virtual machines of a cloud system of claim 4, wherein, the distance between the initial probabilistic logarithm probability distribution of the normal virtual machine and the probabilistic logarithm probability of the online virtual machine in the cloud system is measured by the simplified Mahalanobis distance, based on the following:
description="In-line Formulae" end="lead"?d=Σh*=1H□□□Ph*−μσ□(15)description="In-line Formulae" end="tail"? wherein, the value of d shows the anomaly degree of the virtual machine's online state and behavior in the cloud system; wherein a threshold value Q represents the normal behavior of the virtual machine and when d≤Q, the state of the virtual machine is normal; and when d>Q, the virtual machine is anomalous.
6. The anomaly detection method for the virtual machines of a cloud system of claim 5, wherein, when a virtual machine is detected operating anomalously, the anomaly detection and treatment system in the cloud system detects the anomaly, and appraises the detection result of the internal virus or the external attack to obtain the anomaly degree index of the virtual machine Ei, Ei=ρ1+ρ2; where ρ1 is an index showing whether the anomalous virtual machine's virus can be treated such that when the virus is treatable, ρ1 is 0; when the virus is not treatable, ρ1 is 1; ρ2 is an index showing whether the anomalous virtual machine's external attack is treatable; such that when the external attack is treatable, ρ1 is 0; and when the external attack is not treatable, ρ2 is 1; and when a seriousness degree index of the anomalous virtual machine Ei<Emax=1, the system issues warnings to the cloud renter of the anomalous virtual machine after removing the anomaly, and when Ei≥Emax=1, the system will issue warnings to the cloud renter of the anomalous virtual machine and shut down the virtual machine.
</claims>
</document>
