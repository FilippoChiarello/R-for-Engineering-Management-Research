<document>

<filing_date>
2019-09-16
</filing_date>

<publication_date>
2020-01-09
</publication_date>

<priority_date>
2017-09-25
</priority_date>

<ipc_classes>
G06K9/20,G06K9/46,G06K9/62,G06N3/08
</ipc_classes>

<assignee>
TENCENT TECHNOLOGY (SHENZHEN) COMPANY
</assignee>

<inventors>
LIU MING
</inventors>

<docdb_family_id>
62869408
</docdb_family_id>

<title>
TEXT DETECTION METHOD, STORAGE MEDIUM, AND COMPUTER DEVICE
</title>

<abstract>
This application provides a text detection method, including: obtaining, by a computer device, an image; inputting the image into a neural network, and outputting a target feature matrix; inputting the target feature matrix into a fully connected layer, the fully connected layer mapping each element of the target feature matrix to a predicated subregion corresponding to the image according to a preset anchor; and obtaining text feature information of the predicated subregion, connecting the predicated subregion into a corresponding predicted text line according to the text feature information of the predicated subregion by using a text clustering algorithm, and determining a text area corresponding to the image.
</abstract>

<claims>
1. A method for performing text detection, the method comprising: obtaining, by a computer device comprising a memory storing instructions and a processor in communication with the memory, an image; inputting, by the computer device, the image into a neural network to obtain a target feature matrix; inputting, by the computer device, the target feature matrix into a fully connected layer to map each element of the target feature matrix to a predicted subregion according to a preset anchor; obtaining, by the computer device, text feature information of the predicted subregion; connecting the predicated subregion into a predicted text line according to the text feature information of the predicated subregion by using a text clustering algorithm; and determining a text area corresponding to the image based on the predicted text line.
2. The method according to claim 1, wherein the inputting the image into the neural network to obtain the target feature matrix comprises: performing, by the computer device, feature extraction on the image to obtain a first feature matrix, an element in the first feature matrix comprising a two-dimensional element; inputting, by the computer device, the first feature matrix into a two-way long short-term memory (LSTM) network to obtain a forward feature matrix and a backward feature matrix; and splicing, by the computer device, the forward feature matrix and the backward feature matrix to obtain the target feature matrix.
3. The method according to claim 2, wherein the inputting the first feature matrix into the two-way LSTM network to obtain the forward feature matrix and the backward feature matrix comprises: obtaining, by the computer device, a current location of a sliding-window matrix, and calculating a current convolution result of the sliding-window matrix and the first feature matrix according to the current location, the sliding-window matrix comprising a forward sliding-window matrix and a backward sliding-window matrix; obtaining, by the computer device, a current internal status value of the two-way LSTM network corresponding to the current location of the sliding-window matrix by using an activation function based on the current convolution result and a previous internal status value of the two-way LSTM network corresponding to a previous location of the sliding-window matrix; sliding, by the computer device, the sliding-window matrix to a next location, setting the next location as the current location, and repeating an operation of obtaining the current location of the sliding-window matrix until the sliding-window matrix traverses elements of the first feature matrix; and processing, by the computer device, internal status values of the two-way LSTM network corresponding to different locations of the sliding-window matrix, to generate a current feature matrix comprising the forward feature matrix and the backward feature matrix.
4. The method according to claim 1, wherein: a width of the preset anchor comprises a fixed value; the text feature information comprises text location information; and obtaining the text feature information of the predicated subregion comprises: for each element of the target feature matrix: obtaining, by the computer device, a horizontal location of the predicated subregion according to the width of the preset anchor and a first dimensional coordinate corresponding to each element of the target feature matrix, obtaining, by the computer device, a vertical-direction predicted offset of the predicated subregion, calculating according to the vertical-direction predicted offset, a height value of the preset anchor, and a central coordinate value component, to respectively obtain a predicted height value corresponding to the predicated subregion and a central-point vertical-direction actual offset, and determining, by the computer device, the text location information of the predicated subregion according to the horizontal location, the predicted height value, and the central-point vertical-direction actual offset.
5. The method according to claim 1, wherein: the text feature information comprises text location information; and connecting the predicated subregion into the predicted text line according to the text feature information of the predicated subregion by using the text clustering algorithm comprises: using, by the computer device, each predicated subregion as a current candidate subregion, to obtain first text location information corresponding to the current candidate subregion; obtaining, by the computer device according to the first text location information, a target candidate subregion with a distance less than a preset distance threshold from the current candidate subregion and with a vertical-direction overlap degree greater than a preset overlap degree threshold, and using the target candidate subregion closest to the current candidate subregion as a neighboring candidate subregion; obtaining, by the computer device, a next candidate subregion corresponding to the current candidate subregion as a current candidate subregion, and repeating a step of obtaining first text location information corresponding to the current candidate subregion, until candidate subregions are traversed; and connecting, by the computer device, a candidate subregion and corresponding neighboring candidate subregion into the predicted text line.
6. The method according to claim 5, wherein: the text feature information comprises text confidence information; and using each predicated subregion as the current candidate subregion comprises: obtaining, by the computer device, text confidence information corresponding to each predicated subregion, and performing, by the computer device, non-maximum suppression on each predicated subregion according to the text confidence information, to obtain a predicated subregion whose text confidence is greater than a preset text confidence threshold as the current candidate subregion.
7. The method according to claim 1, wherein after connecting the predicated subregion into the predicted text line according to the text feature information of the predicated subregion by using the text clustering algorithm, the method further comprises: obtaining, by the computer device, a predicted horizontal direction offset corresponding to each predicted text line; and correcting, by the computer device, a horizontal boundary of the predicted text line according to the predicted horizontal direction offset.
8. The method according to claim 1, wherein before obtaining the image, the method further comprises: obtaining, by the computer device, training data comprising a set of sample images comprising a preset size proportion; performing, by the computer device, feature extraction on the set of sample images, and inputting into the neural network, the neural network being obtained by initializing the neural network by using a Gaussian distribution random number with a preset average value and variance; obtaining, by the computer device, a feature matrix outputted by the neural network, and mapping the feature matrix to a sample subregion by using the fully connected layer, to obtain the sample subregion; obtaining, by the computer device, text feature information corresponding to each sample subregion, and obtaining the predicted text line according to the text feature information corresponding to each sample subregion by using the text clustering algorithm; and performing, by the computer device, optimization training by repeating a step of obtaining training data, according to a preset potential energy item and a preset weight attenuation value, to obtain a target text detection model according to a target optimization function.
9. A computer device, comprising a memory and a processor in communication with the memory, the memory storing an instruction, wherein, the instruction, when executed by the processor, is configured to cause the processor to perform: obtaining an image; inputting the image into a neural network to obtain a target feature matrix; inputting the target feature matrix into a fully connected layer to map each element of the target feature matrix to a predicated subregion according to a preset anchor; obtaining text feature information of the predicated subregion; connecting the predicated subregion into a predicted text line according to the text feature information of the predicated subregion by using a text clustering algorithm; and determining a text area corresponding to the image based on the predicted text line.
10. The computer device according to claim 9, wherein, when the instruction is configured to cause the processor to perform inputting the image into the neural network to obtain the target feature matrix, the instruction is configured to cause the processor to perform: performing feature extraction on the image, to obtain a first feature matrix, an element in the first feature matrix comprising a two-dimensional element; inputting the first feature matrix into a two-way long short-term memory (LSTM) network, to obtain a forward feature matrix and a backward feature matrix; and splicing the forward feature matrix and the backward feature matrix to obtain the target feature matrix.
11. The computer device according to claim 10, wherein, when the instruction is configured to cause the processor to perform inputting the first feature matrix into the two-way LSTM network, to obtain a forward feature matrix and a backward feature matrix, the instruction is configured to cause the processor to perform: obtaining a current location of a sliding-window matrix, and calculating a current convolution result of the sliding-window matrix and the first feature matrix according to the current location, the sliding-window matrix comprising a forward sliding-window matrix and a backward sliding-window matrix; obtaining a current internal status value of the two-way LSTM network corresponding to the current location of the sliding-window matrix by using an activation function based on the current convolution result and a previous internal status value of the two-way LSTM network corresponding to a previous location of the sliding-window matrix; sliding the sliding-window matrix to obtain a next location, and setting the next location as the current location, and repeating an operation of obtaining the current location of the sliding-window matrix, until the sliding-window matrix traverses elements of the first feature matrix; and processing internal status values of the two-way LSTM network corresponding to different locations of the sliding-window matrix, to generate a current feature matrix comprising the forward feature matrix and the backward feature matrix.
12. The computer device according to claim 9, wherein: a width value of the preset anchor comprises a fixed value; and when the instruction is configured to cause the processor to perform obtaining the text feature information of the predicated subregion, the instruction is configured to cause the processor to perform: obtaining a horizontal location of the predicated subregion according to the width value of the preset anchor and a first dimensional coordinate corresponding to each element of the target feature matrix, obtaining a vertical-direction predicted offset of the predicated subregion, calculating according to the vertical-direction predicted offset, a height value of the preset anchor, and a central coordinate value component, to respectively obtain a predicted height value corresponding to the predicated subregion and a central-point vertical-direction actual offset, and determining the text location information of the predicated subregion according to the horizontal location, the predicted height value, and the central-point vertical-direction actual offset.
13. The computer device according to claim 9, wherein: the text feature information comprises text location information; and when the instruction is configured to cause the processor to perform connecting the predicated subregion into the predicted text line according to the text feature information of the predicated subregion by using a preset text clustering algorithm, the instruction is configured to cause the processor to perform: using each predicated subregion as a current candidate subregion, to obtain first text location information corresponding to the current candidate subregion, obtaining, according to the first text location information, a target candidate subregion with a distance less than a preset distance threshold from the current candidate subregion and with a vertical-direction overlap degree greater than a preset overlap degree threshold, and using the target candidate subregion closest to the current candidate subregion as a neighboring candidate subregion, obtaining a next candidate subregion corresponding to the current candidate subregion as a current candidate subregion, and repeating a step of obtaining first text location information corresponding to the current candidate subregion, until candidate subregions are traversed, and connecting a candidate subregion and corresponding neighboring candidate subregion into the predicted text line.
14. The computer device according to claim 9, wherein before obtaining the image, the instruction is configured to cause the processor to perform: obtaining training data, the training data comprising a set of sample images comprising a preset size proportion; performing feature extraction on the set of sample images, and inputting into the neural network, the neural network being obtained by initializing the neural network by using a Gaussian distribution random number with a preset average value and variance; obtaining a feature matrix outputted by the neural network, and mapping the feature matrix to a sample subregion by using the fully connected layer, to obtain the sample subregion; obtaining text feature information corresponding to each sample subregion, and obtaining the predicted text line according to the text feature information corresponding to each sample subregion by using the preset text clustering algorithm; and performing optimization training by repeating a step of obtaining training data, according to a preset potential energy item and a preset weight attenuation value, to obtain a target text detection model according to a target optimization function.
15. A non-transitory computer readable storage medium storing instructions, wherein the instructions, when executed by a processor, are configured to cause the processor to: obtain an image; input the image into a neural network to obtain a target feature matrix; input the target feature matrix into a fully connected layer to map each element of the target feature matrix to a predicted subregion according to a preset anchor; obtain text feature information of the predicted subregion; connect the predicated subregion into a predicted text line according to the text feature information of the predicated subregion by using a text clustering algorithm; and determine a text area corresponding to the image based on the predicted text line.
16. The non-transitory computer storage medium according to claim 15, wherein, when the instructions are configured to cause the processor to input the image into the neural network to obtain the target feature matrix, the instructions are configured to cause the processor to: perform feature extraction on the image, to obtain a first feature matrix, an element in the first feature matrix comprising a two-dimensional element; input the first feature matrix into a two-way long short-term memory (LSTM) network, to obtain a forward feature matrix and a backward feature matrix; and splice the forward feature matrix and the backward feature matrix to obtain the target feature matrix.
17. The non-transitory computer storage medium according to claim 16, wherein, when the instructions are configured to cause the processor to input the first feature matrix into the two-way LSTM network, to obtain a forward feature matrix and a backward feature matrix, the instructions are configured to cause the processor to: obtain a current location of a sliding-window matrix, and calculate a current convolution result of the sliding-window matrix and the first feature matrix according to the current location, the sliding-window matrix comprising a forward sliding-window matrix and a backward sliding-window matrix; obtain a current internal status value of the two-way LSTM network corresponding to the current location of the sliding-window matrix by using an activation function based on the current convolution result and a previous internal status value of the two-way LSTM network corresponding to a previous location of the sliding-window matrix; slide the sliding-window matrix to obtain a next location, and set the next location as the current location, and repeat an operation to obtain the current location of the sliding-window matrix, until the sliding-window matrix traverses elements of the first feature matrix; and process internal status values of the two-way LSTM network corresponding to different locations of the sliding-window matrix, to generate a current feature matrix comprising the forward feature matrix and the backward feature matrix.
18. The non-transitory computer storage medium according to claim 15, wherein: a width value of the preset anchor comprises a fixed value; and when the instructions are configured to cause the processor to obtain the text feature information of the predicated subregion, the instructions are configured to cause the processor to: obtain a horizontal location of the predicated subregion according to the width value of the preset anchor and a first dimensional coordinate corresponding to each element of the target feature matrix, obtain a vertical-direction predicted offset of the predicated subregion, calculate according to the vertical-direction predicted offset, a height value of the preset anchor, and a central coordinate value component, to respectively obtain a predicted height value corresponding to the predicated subregion and a central-point vertical-direction actual offset, and determine the text location information of the predicated subregion according to the horizontal location, the predicted height value, and the central-point vertical-direction actual offset.
19. The non-transitory computer storage medium according to claim 15, wherein: the text feature information comprises text location information; and when the instructions are configured to cause the processor to connect the predicated subregion into the predicted text line according to the text feature information of the predicated subregion by using a preset text clustering algorithm, the instructions are configured to cause the processor to: use each predicated subregion as a current candidate subregion, to obtain first text location information corresponding to the current candidate subregion, obtain, according to the first text location information, a target candidate subregion with a distance less than a preset distance threshold from the current candidate subregion and with a vertical-direction overlap degree greater than a preset overlap degree threshold, and use the target candidate subregion closest to the current candidate subregion as a neighboring candidate subregion, obtain a next candidate subregion corresponding to the current candidate subregion as a current candidate subregion, and repeat a step to obtain first text location information corresponding to the current candidate subregion, until candidate subregions are traversed, and connect a candidate subregion and corresponding neighboring candidate subregion into the predicted text line.
20. The non-transitory computer storage medium according to claim 15, wherein, before the instructions are configured to cause the processor to obtain the image, the instructions are configured to cause the processor to: obtain training data, the training data comprising a set of sample images comprising a preset size proportion; perform feature extraction on the set of sample images, and input into the neural network, the neural network being obtained by initializing the neural network by using a Gaussian distribution random number with a preset average value and variance; obtain a feature matrix outputted by the neural network, and map the feature matrix to a sample subregion by using the fully connected layer, to obtain the sample subregion; obtain text feature information corresponding to each sample subregion, and obtain the predicted text line according to the text feature information corresponding to each sample subregion by using the preset text clustering algorithm; and perform optimization training by repeating a step to obtain training data, according to a preset potential energy item and a preset weight attenuation value, to obtain a target text detection model according to a target optimization function.
</claims>
</document>
