<document>

<filing_date>
2020-01-28
</filing_date>

<publication_date>
2020-10-22
</publication_date>

<priority_date>
2019-04-16
</priority_date>

<ipc_classes>
G06F16/23,G06F16/2458,G06F16/248,G06F16/25,G06F3/06
</ipc_classes>

<assignee>
SNOWFLAKE
</assignee>

<inventors>
CSERI, ISTVAN
CRUANES, THIERRY
DAGEVILLE, BENOIT
GRABS, TORSTEN
SHAH, SAURIN
MURALIDHAR, SUBRAMANIAN
Shingte, Nileema
</inventors>

<docdb_family_id>
72829436
</docdb_family_id>

<title>
MATERIALIZED VIEWS OVER EXTERNAL TABLES IN DATABASE SYSTEMS
</title>

<abstract>
Systems, methods, and devices for generating a materialized view over an external table. A method includes connecting a database platform to an external table such that the database platform has read access for the external table and does not have write access for the external table. The method includes generating, by the database platform, a materialized view over the external table. The method includes receiving a notification that a modification has been made to the external table, the modification comprising one or more of an addition of a file, a deletion of a file, or an update to a file in a source location for the external table. The method includes, in response to the external table being modified, refreshing the materialized view such that the materialized view comprises an accurate representation of the external table.
</abstract>

<claims>
1. A system comprising: at least one processor; a memory device including instructions, which when executed by the at least one processor, cause the at least one processor to perform operations comprising: connecting a database platform to an external table such that the database platform has read access for the external table and does not have write access for the external table; generating a materialized view over the external table; receiving a notification that a modification has been made to the external table, the modification comprising at least inserting a partition, the partition including at least a portion of data from the external table; and generating a refreshed materialized view in response to the external table being modified such that the refreshed materialized view comprises a representation of the external table after the modification has been made.
2. The system of claim 1, wherein the partition comprises one or more immutable storage objects, and the modification further comprises deleting a second partition, the second partition including at least a second portion of the data from the external table, and the memory device includes further instructions, which when executed by the at least one processor, cause the at least one processor to perform further operations comprising: providing the refreshed materialized view to a client device in response to a request from the client device.
3. The system of claim 1, wherein the external table is based on a source location in a data storage platform, wherein the data storage platform is separate from the database platform.
4. The system of claim 1, wherein the memory device includes further instructions, which when executed by the at least one processor, cause the at least one processor to perform further operations comprising: determining content for the materialized view, wherein the determining the content comprises receiving an indication to generate the materialized view with the content.
5. The system of claim 3, wherein the receiving the notification comprises one or more of: querying the data storage platform to determine whether any modifications have been made to a source location; receiving a notification from the data storage platform that a modification has been made to the source location; or receiving a notification from a respective client device associated with a source directory, the notification indicating that the modification has been made to the source location.
6. The system of claim 1, wherein generating the refreshed materialized view comprises generating a new materialized view and removing an original materialized view that is stale with respect to the external table.
7. The system of claim 1, wherein the memory device includes further instructions, which when executed by the at least one processor, cause the at least one processor to perform further operations comprising: receiving a query; determining one or more partitions in the external table that are necessary to respond to the query by reading metadata for the external table; and determining whether part or all of the query can be satisfied by one or more materialized views.
8. The system of claim 7, wherein the memory device includes further instructions, which when executed by the at least one processor, cause the at least one processor to perform further operations comprising: generating a query plan for responding to the query, the query plan comprising a plurality of discrete subtasks; and assigning the plurality of discrete subtasks to one or more nodes of an execution platform, wherein, in response to there being a matching materialized view that matches part or all of the query, at least one of the plurality of discrete subtasks comprises reading the matching materialized view, and wherein, in response to there being no matching materialized view that matches part or all of the query, at least one of the plurality of discrete subtasks comprises reading the external table.
9. The system of claim 8, further comprising determining whether the matching materialized view is stale with respect to the external table.
10. The system of claim 1, further comprising generating metadata for the materialized view, the metadata comprising at least one of: an identification of one or more partitions of the external table that are materialized in the materialized view, a minimum/maximum value pair for each of the one or more partitions that are materialized in the materialized view, or a timestamp for a most recent refresh of the materialized view.
11. The system of claim 10, wherein the memory device includes further instructions, which when executed by the at least one processor, cause the at least one processor to perform further operations comprising: reading the timestamp for the most recent refresh of the materialized view; and determining whether the materialized view is stale with respect to the external table based on the timestamp for the most recent refresh of the materialized view.
12. A method comprising: connecting a database platform to an external table such that the database platform has read access for the external table and does not have write access for the external table; generating, by the database platform, a materialized view over the external table; receiving a notification that a modification has been made to the external table, the modification comprising at least inserting a partition, the partition including at least a portion of data from the external table; in response to the external table being modified, generating a refreshed materialized view such that the refreshed materialized view comprises a representation of the external table after the modification has been made; and providing the refreshed materialized view to a client device in response to a request from the client device.
13. The method of claim 12, wherein the external table is based on a source location in a data storage platform, wherein the data storage platform is separate from the database platform.
14. The method of claim 12, further comprising determining content for the materialized view by receiving an indication to generate the materialized view with the content.
15. The method of claim 13, wherein receiving the notification comprises one or more of: receiving a notification from the data storage platform that a modification has been made to a source location; or receiving a notification from a respective client device associated with the source location, the notification indicating that the modification has been made to the source location.
16. The method of claim 12, wherein generating the refreshed materialized view comprises generating a new materialized view.
17. The method of claim 12, further comprising: receiving a query; determining one or more partitions in the external table that are necessary to respond to the query by reading metadata for the external table; and determining whether part or all of the query can be satisfied by a matching materialized view.
18. The method of claim 17, further comprising: generating a query plan for responding to the query, the query plan comprising a plurality of discrete subtasks; and assigning the plurality of discrete subtasks to one or more nodes of an execution platform, wherein, in response to there being the matching materialized view, at least one of the plurality of discrete subtasks comprises reading the matching materialized view, and wherein, in response to there being no matching materialized view, at least one of the plurality of discrete subtasks comprises reading the external table.
19. The method of claim 18, further comprising determining whether a corresponding materialized view is stale with respect to the external table.
20. The method of claim 12, further comprising generating metadata for the materialized view, the metadata comprising at least one of: an identification of one or more partitions of the external table that are materialized in the materialized view, a minimum/maximum value pair for each of the one or more partitions that are materialized in the materialized view, or a timestamp for a most recent refresh of the materialized view.
21. The method of claim 20, further comprising: reading a timestamp for a most recent modification to the external table; reading the timestamp for the most recent refresh of the materialized view; and determining whether the materialized view is stale with respect to the external table based on the timestamp for the most recent refresh of the materialized view.
22. A non-transitory computer-readable medium comprising instructions, which when executed by at least one processor, cause the at least one processor to perform operations comprising: connecting a database platform to an external table such that the database platform has read access for the external table and does not have write access for the external table; generating, by the database platform, a materialized view over the external table; receiving a notification that a modification has been made to the external table, the modification comprising at least inserting a partition, the partition including at least a portion of data from the external table; in response to the external table being modified, generating a refreshed materialized view such that the refreshed materialized view comprises a representation of the external table after the modification has been made, wherein the external table is based on a source location in a data storage platform, wherein the data storage platform is separate from the database platform; and providing the refreshed materialized view to a client device in response to a request from the client device.
23. The non-transitory computer-readable medium of claim 22, wherein the non-transitory computer-readable medium comprises further instructions, which when executed by the at least one processor, further cause the at least one processor to perform further operations comprising: determining content for the materialized view by receiving an indication to generate the materialized view with the content.
24. The non-transitory computer-readable medium of claim 22, wherein receiving the notification comprises at least one of: receiving a notification from the data storage platform that a modification has been made to a source location; or receiving a notification from a respective client device associated with the source location, the notification indicating that the modification has been made to the source location.
25. The non-transitory computer-readable medium of claim 22, wherein the non-transitory computer-readable medium comprises further instructions, which when executed by the at least one processor, further cause the at least one processor to perform further operations comprising: receiving a query; determining one or more partitions in the external table that are necessary to respond to the query by reading metadata for the external table; determining whether a matching materialized view has been generated for part or all of the query; generating a query plan for responding to the query, the query plan comprising a plurality of discrete subtasks; and assigning the plurality of discrete subtasks to one or more nodes of an execution platform, wherein, in response to there being the matching materialized view, at least one of the plurality of discrete subtasks comprises reading a corresponding materialized view, and wherein, in response to there being no matching materialized view, at least one of the plurality of discrete subtasks comprises reading the external table.
26. The non-transitory computer-readable medium of claim 25, wherein the non-transitory computer-readable medium comprises further instructions, which when executed by the at least one processor, further cause the at least one processor to perform further operations comprising: generating a query plan for responding to the query, the query plan comprising a plurality of discrete subtasks; assigning the plurality of discrete subtasks to one or more nodes of an execution platform, wherein, in response to there being the matching materialized view, at least one of the plurality of discrete subtasks comprises reading the matching materialized view, and wherein, in response to there being no matching materialized view, at least one of the plurality of discrete subtasks comprises reading the external table; and determining whether a corresponding materialized view is stale with respect to the external table.
27. The non-transitory computer-readable medium of claim 22, wherein the non-transitory computer-readable medium comprises further instructions, which when executed by the at least one processor, further cause the at least one processor to perform further operations comprising: generating metadata for the materialized view, the metadata comprising at least one of: an identification of one or more partitions of the external table that are materialized in the materialized view, a minimum/maximum value pair for each of the one or more partitions that are materialized in the materialized view, or a timestamp for a most recent refresh of the materialized view.
28. The non-transitory computer-readable medium of claim 27, wherein the non-transitory computer-readable medium comprises further instructions, which when executed by the at least one processor, further cause the at least one processor to perform further operations comprising: reading a timestamp for a most recent modification to the external table; reading the timestamp for the most recent refresh of the materialized view; and determining whether the materialized view is stale with respect to the external table based on the timestamp for the most recent refresh of the materialized view.
</claims>
</document>
