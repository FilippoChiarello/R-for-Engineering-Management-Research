<document>

<filing_date>
2020-03-31
</filing_date>

<publication_date>
2020-10-14
</publication_date>

<priority_date>
2019-04-09
</priority_date>

<ipc_classes>
G06K9/00,G06T5/00,G06T5/50
</ipc_classes>

<assignee>
GUANGDONG OPPO MOBILE TELECOMMUNICATIONS CORPORATION
</assignee>

<inventors>
LIN, Quanyou
</inventors>

<docdb_family_id>
67318597
</docdb_family_id>

<title>
METHOD AND APPARATUS FOR IMAGE PROCESSING
</title>

<abstract>
A method and an apparatus for image processing are provided. An original image is captured. At least one reference image is generated by adjusting brightness of the original image. Multiple denoised images are generated by performing artificial intelligence based denoising on the original image and the at least one reference image respectively. A target image is generated by performing HDR synthesis on the multiple denoised images. In this way, by using the AI-based denoising, the image purity can be guaranteed, and more image details can be preserved. Moreover, since the images used for synthesis are all derived from the original image, the ghosting effect in the target image synthesized due to misalignment can be avoided.
</abstract>

<claims>
1. A method for image processing, comprising: capturing (101) an original image; generating (102) at least one reference image by adjusting brightness of the original image; generating (103) a plurality of denoised images by performing artificial intelligence-based (AI-based) denoising on the original image and the at least one reference image respectively; and generating (104) a target image by performing high dynamic range (HDR) synthesis on the plurality of denoised images.
2. The method of claim 1, wherein capturing (101) the original image comprises: obtaining an ambient light intensity; determining an initial exposure according to the ambient light intensity; and capturing the original image according to the initial exposure.
3. The method of claim 2, wherein determining the initial exposure according to the ambient light intensity comprises: determining the initial exposure as a first exposure when the ambient light intensity is lower than or equal to a first threshold intensity; determining the initial exposure as a second exposure when the ambient light intensity is higher than the first threshold intensity and lower than or equal to a second threshold intensity; and determining the initial exposure as a third exposure when the ambient light intensity is higher than the second threshold intensity, wherein the first exposure is smaller than the second exposure, and the second exposure is smaller than the third exposure.
4. The method of claim 2, wherein determining the initial exposure according to the ambient light intensity comprises: capturing a preview image; detecting whether the preview image contains a face region; determining a portrait mode according to the ambient light intensity upon detecting that the preview image contains the face region; and determining a value of exposure adjustment according to the portrait mode and adjusting the initial exposure according to the value of exposure adjustment.
5. The method of any of claims 1 to 4, wherein generating (102) the at least one reference image by adjusting the brightness of the original image comprises: obtaining average pixel brightness of the original image; determining at least one exposure compensation amount according to the average pixel brightness; and generating the at least one reference image by adjusting the brightness of the original image according to the at least one exposure compensation amount respectively.
6. The method of claim 5, wherein generating the at least one reference image by adjusting the brightness of the original image according to the at least one exposure compensation amount respectively comprises:
generating the at least one reference image by inputting the original image into a plurality of brightening models respectively, wherein each of the plurality of brightening models corresponds to each of the at least one exposure compensation amount and is configured to adjust the brightness of the original image according to pixel brightness of the original image and the exposure compensation amount.
7. The method of any of claims 1 to 4, wherein generating (102) the at least one reference image by adjusting the brightness of the original image comprises: dividing the original image into a plurality of sub-regions and obtaining average pixel brightness of each of the sub-regions; calculating a brightness difference between average pixel brightness of every two sub-regions; determining to generate one reference image by adjusting the brightness of the original image, when brightness differences are all within a preset range; and determining to generate a plurality of reference images by adjusting brightness of different regions in the original image to different degrees, when not all the brightness differences are within the preset range.
8. The method of any of claims 1 to 4, wherein generating (102) the at least one reference image by adjusting the brightness of the original image comprises: detecting whether the original image contains a target region according to an image semantic recognition algorithm; determining a first exposure compensation amount according to pixel brightness of the target region upon detecting that the original image contains the target region; determining a second exposure compensation amount according to pixel brightness of a non-target region; generating a corresponding reference image by adjusting brightness of the target region in the original image according to the first exposure compensation amount; and generating another corresponding reference image by adjusting brightness of the non-target region in the original image according to the second exposure compensation amount.
9. The method of claim 8, wherein the target region comprises a plurality of face regions,
determining the first exposure compensation amount according to the pixel brightness of the target region comprises:
for each of the plurality of face regions, determining a first exposure compensation amount corresponding to the face region according to average pixel brightness of the face region; and
generating the corresponding reference image by adjusting the brightness of the target region in the original image according to the first exposure compensation amount comprises:
for each of the plurality of face regions, generating the reference image corresponding to the face region by adjusting brightness of the face region in the original image according to the first exposure compensation amount corresponding to the face region.
10. The method of claim 8, further comprising:
generating the at least one reference image by adjusting the brightness of the original image as a whole upon detecting that the original image does not contain the target region.
11. The method of any of claims 1 to 10, wherein generating (103) the plurality of denoised images by performing the AI-based denoising on the original image and the at least one reference image respectively comprises: performing, with a neural network model, noise characteristic recognition on the original image and the at least one reference image respectively, wherein the neural network model has learned a mapping relationship between sensitivity and noise characteristic of the original image and the at least one reference image; and obtaining the plurality of denoised images by performing denoising on the original image and the at least one reference image respectively according to a recognized noise characteristic.
12. The method of claim 11, wherein the neural network model is trained using sample images corresponding to different sensitivity until a noise characteristic recognized by the neural network model matches a noise characteristic identified in a corresponding sample image.
13. The method of claim 12, further comprising: determining a plurality of reference pixels in the target image; calculating a difference of pixel grayscale between the plurality of reference pixels according to a preset gradient function; and modifying a corresponding parameter of the neural network model when the difference of pixel grayscale is greater than a preset threshold.
14. The method of any of claims 1 to 13, wherein generating the target image by performing the HDR synthesis on the plurality of denoised images comprises: inputting the plurality of denoised images into an HDR synthesis model and obtaining synthesis weights for respective regions of the original image, wherein the HDR synthesis model has learned a mapping relationship between characteristics of the respective regions and the synthesis weights, and wherein the characteristic is indicative of exposure and brightness of corresponding image regions; and generating the target image by performing the HDR synthesis on the plurality of denoised images per region according to the synthesis weights.
15. An electronic device (200), comprising
an image sensor (210);
a processor (220) comprising an image signal processing (ISP) processor (91) and a graphic processing unit (GPU) (96) coupled with the ISP processor ; and
a memory (230) configured to store computer programs which, when executed by the processor, are operable to: capture, with the image sensor under control of the ISP processor, an original image; generate, with the GPU, at least one reference image by adjusting brightness of the original image; generate, with the GPU, a plurality of denoised images by performing artificial intelligence-based (AI-based) denoising on the original image and the at least one reference image respectively; and generate, with the ISP processor, a target image by performing high dynamic range (HDR) synthesis on the plurality of denoised images.
</claims>
</document>
