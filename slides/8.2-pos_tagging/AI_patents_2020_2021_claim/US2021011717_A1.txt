<document>

<filing_date>
2020-09-29
</filing_date>

<publication_date>
2021-01-14
</publication_date>

<priority_date>
2019-05-20
</priority_date>

<ipc_classes>
G06F9/30,G06F9/32
</ipc_classes>

<assignee>
MICROSOFT TECHNOLOGY LICENSING
</assignee>

<inventors>
IYIGUN, MEHMET
LIN, JASON
MAJMUDAR, Niraj
LIN, Jin
</inventors>

<docdb_family_id>
74103109
</docdb_family_id>

<title>
Verified Stack Trace Generation And Accelerated Stack-Based Analysis With Shadow Stacks
</title>

<abstract>
A verified stack trace can be generated by utilizing information contained in a shadow stack, such as a hardware protected duplicate stack implemented for malware prevention and computer security. The shadow stack contains return addresses which are obtainable without requiring an unwinding of the traditional call stack. As such, triaging based on return address information can be performed more quickly and more efficiently, and with a reduced utilization of processing resources. Additionally, the generation of a verified stack trace can be performed, with such a verified stack trace containing return addresses that are known to be correct and not corrupted. The return addresses can either be read from the traditional call stack, or derived therefrom, and then verified by comparison to corresponding return addresses from the shadow stack, or they can be read directly from the shadow stack.
</abstract>

<claims>
We claim:
1. A computing device comprising: one or more central processing units that push return addresses onto both a call stack and a shadow stack; and one or more computer-readable storage media comprising computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: compare a first return address obtained from the call stack to a corresponding first return address obtained from the shadow stack; and generate a verified stack trace comprising both the first return address obtained from the shadow stack and the first return address obtained from the call stack when the comparing reveals that the first return address obtained from the call stack differs from the corresponding first return address obtained from the shadow stack.
2. The computing device of claim 1, wherein the computer-executable instructions directed to generating the verified stack trace comprise computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: also include, in the verified stack trace, an indication that the included first return address obtained from the call stack is incorrect when the comparing reveals that the first return address obtained from the call stack differs from the corresponding first return address obtained from the shadow stack.
3. The computing device of claim 1, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: generate an indication that the generated verified stack trace comprises return addresses that have been verified using the shadow stack.
4. The computing device of claim 1, wherein the first return address obtained from the shadow stack is only included in the generated verified stack trace if a quantity of return addresses from the call stack that differ from corresponding return addresses from the shadow stack is greater than a threshold.
5. The computing device of claim 1, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: compare return addresses obtained from the shadow stack to pre-determined characteristics of a first bug, the addresses obtained from the shadow stack comprising the first return address obtained from the shadow stack; determine, based on the comparing, that the return addresses obtained from the shadow stack match the pre-determined characteristics of a first bug; and associate, based on the determining, one or more dump files comprising the return addresses obtained from the shadow stack with the first bug.
6. The computing device of claim 1, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: compare return addresses obtained from the shadow stack to pre-determined characteristics of cataloged bugs, the addresses obtained from the shadow stack comprising the first return address obtained from the shadow stack; determine, based on the comparing, that the return addresses obtained from the shadow stack do not match the pre-determined characteristics of the cataloged bugs; and generate an indication, based on the determining, that one or more dump files comprising the return addresses obtained from the shadow stack require further review.
7. The computing device of claim 6, wherein the computer-executable instructions directed to generating the verified stack trace are executed contingent upon the indication that the one or more dump files comprising the return addresses obtained from the shadow stack require further review.
8. A computing device comprising: one or more central processing units that push return addresses onto both a call stack and a shadow stack; and one or more computer-readable storage media comprising computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: generate a verified stack trace comprising both a first return address obtained from the shadow stack and a corresponding first return address obtained from the call stack, the first return address obtained from the shadow stack differing from the corresponding first return address obtained from the call stack.
9. The computing device of claim 8, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: compare the return addresses obtained from the shadow stack to pre-determined characteristics of a first bug; determine, based on the comparing, that the return addresses obtained from the shadow stack match the pre-determined characteristics of a first bug; and associate, based on the determining, one or more dump files comprising the return addresses obtained from the shadow stack with the first bug.
10. The computing device of claim 8, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: compare the return addresses obtained from the shadow stack to pre-determined characteristics of cataloged bugs; determine, based on the comparing, that the return addresses obtained from the shadow stack do not match the pre-determined characteristics of the cataloged bugs; and generate an indication, based on the determining, that one or more dump files comprising the return addresses obtained from the shadow stack require further review.
11. The computing device of claim 10, wherein the computer-executable instructions directed to generating the verified stack trace are executed contingent upon the indication that the one or more dump files comprising the return addresses obtained from the shadow stack require further review.
12. The computing device of claim 8, comprising further computer-executable instructions, which, when executed by at least some of the processing units, cause the computing device to: generate an indication that the generated verified stack trace comprises return addresses that have been verified using the shadow stack.
13. A system comprising: a dump-generating computing device comprising: one or more dump-generating computing device processing units that push return addresses onto both a call stack and a shadow stack; and one or more dump-generating computing device storage media comprising computer-executable instructions, which, when executed by at least some of the dump-generating computing device processing units, cause the dump-generating computing device to store, on a storage device communicationally coupled to the dump-generating computing device, one or more dump files; and a dump-triaging computing device comprising: one or more dump-triaging computing device processing units; and one or more dump-triaging computing device storage media comprising computer-executable instructions, which, when executed by at least some of the dump-triaging computing device processing units, cause the dump-triaging computing device to: obtain the one or more dump files; parse the one or more dump files for return addresses from the shadow stack; compare the return addresses from the shadow stack to pre-determined one or more return address characteristics of cataloged bugs; and associate the one or more dump files with none or more of the cataloged bugs based on the comparing.
14. The system of claim 13, wherein the comparing determines that the return addresses from the shadow stack match at least some of the pre-determined return address characteristics of a first bug from among the cataloged bugs; and wherein further the one or more dump-triaging computing device storage media comprise further computer-executable instructions, which, when executed by at least some of the dump-triaging computing device processing units, cause the dump-triaging computing device to: associate, based on the comparing determination, the one or more dump files with the first bug.
15. The system of claim 13, wherein the comparing determines that the return addresses from the shadow stack do not match the pre-determined return address characteristics of the cataloged bugs; and wherein further the one or more dump-triaging computing device storage media comprise further computer-executable instructions, which, when executed by at least some of the dump-triaging computing device processing units, cause the dump-triaging computing device to: generate an indication, based on the comparing determination, that the one or more dump files require further review.
16. The system of claim 13, wherein the comparing determines that the return addresses from the shadow stack do not match the pre-determined return address characteristics of the cataloged bugs; wherein further the one or more dump-triaging computing device storage media comprise further computer-executable instructions, which, when executed by at least some of the dump-triaging computing device processing units, cause the dump-triaging computing device to: additionally compare other data from the one or more dump files to corresponding pre-determined characteristics of the cataloged bugs; and associate the one or more dump files with none or more of the cataloged bugs based on the additional comparing; and wherein further the computer-executable instructions performing the additional comparing and the associating based on the additional comparing are only executed if the comparing determines that the return addresses from the shadow stack do not match the pre-determined return address characteristics of the cataloged bugs.
17. The system of claim 13, further comprising a stack-trace-generating computing device comprising: one or more stack-trace-generating computing device processing units; and one or more stack-trace-generating computing device storage media comprising computer-executable instructions, which, when executed by at least some of the stack-trace-generating computing device processing units, cause the stack-trace-generating computing device to: generate a verified stack trace comprising both a first return address obtained from the shadow stack and a corresponding first return address obtained from the call stack, the first return address obtained from the shadow stack differing from the corresponding first return address obtained from the call stack.
18. The system of claim 17, wherein the computer-executable instructions directed to generating the verified stack trace are executed contingent upon an indication that the one or more dump files require further review, the indication that the one or more dump files require further review being based on the comparing determining that the return addresses from the shadow stack do not match the pre-determined return address characteristics of the cataloged bugs.
19. The system of claim 13, wherein the one or more dump-generating computing device storage media comprise further computer-executable instructions, which, when executed by at least some of the dump-generating computing device processing units, cause the dump-generating computing device to: compare, prior to storing the one or more dump files, the return addresses from the shadow stack to the pre-determined one or more return address characteristics of cataloged bugs; and select information from the dump-generating computing device to be stored in the one or more dump files based on the pre-dump-generation comparing.
20. The system of claim 19, wherein the computer-executable instructions directed to selecting the information from the dump-generating computing device to be stored in the one or more dump files comprise computer-executable instructions, which, when executed by at least some of the dump-generating computing device processing units, cause the dump-generating computing device to: only select the information from the dump-generating computing device that is specified by a bug catalog entry associated with a first cataloged bug based on the pre-dump-generation comparing determining that the return addresses from the shadow stack match the pre-determined one or more return address characteristics of the first cataloged bug.
</claims>
</document>
