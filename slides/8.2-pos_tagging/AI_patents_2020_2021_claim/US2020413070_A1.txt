<document>

<filing_date>
2020-04-23
</filing_date>

<publication_date>
2020-12-31
</publication_date>

<priority_date>
2019-06-28
</priority_date>

<ipc_classes>
H04N19/124,H04N19/147,H04N19/154,H04N19/159,H04N19/17,H04N19/182
</ipc_classes>

<assignee>
GUANGDONG OPPO MOBILE TELECOMMUNICATIONS CORPORATION
</assignee>

<inventors>
HUANG, Haidong
</inventors>

<docdb_family_id>
67923195
</docdb_family_id>

<title>
METHOD FOR IMAGE CODING, ELECTRONIC DEVICE AND COMPUTER-READABLE STORAGE MEDIUM
</title>

<abstract>
A method for image coding, an electronic device and a computer-readable storage medium. The method includes: an object region is acquired from a reference image; a pixel block forming the reference image is acquired, and multiple sets of coded data for the pixel are obtained by coding the pixel block in multiple coding modes respectively, each set corresponding to a respective one of the multiple coding modes; a cost parameter of the pixel block is determined based on a relative position relationship between the pixel block and the object region; a coding cost in each of the multiple coding modes for the pixel block, is obtained according to the cost parameter of the pixel block and the coded data in the coding mode; and a set of coded data corresponding to the coding mode with a lowest coding cost is determined as target coded data for the pixel block.
</abstract>

<claims>
1. A method for image coding, comprising: acquiring an object region from a reference image; acquiring a plurality of pixel blocks forming the reference image; obtaining multiple sets of coded data for the plurality of the pixel blocks by coding each pixel block in multiple coding modes, each set of the coded data corresponding to a coding mode of the multiple coding modes; determining a cost parameter of the plurality of the pixel blocks based on a relative position relationship between the plurality of the pixel blocks and the object region; obtaining a coding cost in each of the multiple coding modes for the plurality of the pixel blocks based on the cost parameter of the plurality of the pixel blocks and the coded data in each coding mode; and determining a set of coded data corresponding to the coding mode with a lowest coding cost as target coded data for the plurality of the pixel blocks.
2. The method of claim 1, wherein determining the cost parameter of the plurality of the pixel blocks based on the relative position relationship between the plurality of the pixel blocks and the object region comprises: acquiring a background region in the reference image other than the object region; when the plurality of the pixel blocks are located in the object region, increasing a distortion weight value in a preset cost parameter to obtain a cost parameter corresponding to the plurality of the pixel blocks; and when the plurality of the pixel blocks are located in the background region, decreasing a bit rate weight value in the preset cost parameter to obtain a cost parameter corresponding to the plurality of the pixel blocks.
3. The method of claim 2, further comprising: performing padding processing on the object region to obtain a transition region; and when the plurality of the pixel blocks are located in the transition region, determining the preset cost parameter to be a cost parameter corresponding to the plurality of the pixel blocks.
4. The method of claim 1, further comprising: before acquiring the plurality of the pixel blocks in the reference image: acquiring a background region in the reference image other than the object region; and dividing the object region into multiple first pixel blocks of a first size, and dividing the background region into multiple second pixel blocks of a second size, wherein the first size is smaller than the second size.
5. The method of claim 1, further comprising: after determining the set of coded data corresponding to the coding mode with the lowest coding cost as the target coded data for the plurality of the pixel blocks, performing transformation on the target coded data to obtain a one-dimensional array corresponding to the plurality of the pixel blocks; when the plurality of the pixel blocks are located in the object region, performing quantization on the one-dimensional array by use of a first step length; and when the plurality of the pixel blocks are located in a background region in the reference image other than the object region, performing quantization on the one-dimensional array by use of a second step length, wherein the first step length is less than the second step length.
6. The method of claim 1, wherein the reference image is a key frame image in a video stream, and the method further comprises: before acquiring the object region from the reference image, sequentially acquiring each frame image in the video stream; recognizing an object region in each frame image; and in a case that an object region in a present frame image is mismatched with an object region in a previous key frame image, determining the present frame image to be the reference image.
7. The method of claim 1, wherein acquiring the object region from the reference image comprises: acquiring the reference image; generating a central weight map corresponding to the reference image, wherein weight values represented by the central weight map gradually decrease from center to edge; inputting the reference image and the central weight map into an object detection model to obtain an object region confidence map; and determining an object in the reference image and acquiring the object region in which the object is located, according to the object region confidence map.
8. The method of claim 7, wherein determining the object in the reference image and acquiring the object region in which the object is located, according to the object region confidence map comprises: processing the object region confidence map to obtain an object mask pattern; detecting the reference image to determine a bright region in the reference image; and determining an object in the reference image and acquiring the object region in which the object is located, according to the bright region in the reference image and the object mask pattern.
9. The method of claim 7, wherein determining the object in the reference image and acquiring the object region in which the object is located, according to the object region confidence map comprises: obtaining a region where each of multiple objects is located in the reference image and a category corresponding to each object according to the object region confidence map; determining an object based on a priority of a category and a size of a region, corresponding to each of the multiple objects; and determining a region where the object is located to be the object region.
10. The method of claim 1, wherein the coding cost in each of the multiple coding modes is obtained with a formula comprising:
description="In-line Formulae" end="lead"?J(mode)=A*S SD+B*R, description="In-line Formulae" end="tail"? where J(mode) represents the coding cost in the coding mode, SSD is a distortion rate, A is a distortion weight value, R is a bit rate of the plurality of the pixel blocks corresponding to the coding mode and B is a bit rate weight value.
11. An electronic device, comprising: a memory; and a processor, wherein a computer program is stored in the memory, and the computer program is executed by the processor to enable the processor to execute the following operations: acquiring an object region from a reference image; acquiring a plurality of pixel blocks forming the reference image; obtaining multiple sets of coded data for the plurality of the pixel blocks by coding each pixel block in multiple coding modes, each set of the coded data corresponding to a coding mode of the multiple coding modes; determining a cost parameter of the plurality of the pixel blocks based on a relative position relationship between the plurality of the pixel blocks and the object region; obtaining a coding cost in each of the multiple coding modes for the plurality of the pixel blocks based on the cost parameter of the plurality of the pixel blocks and the coded data in each coding mode; and determining a set of coded data corresponding to the coding mode with a lowest coding cost as target coded data for the plurality of the pixel blocks.
12. The electronic device according to claim 11, wherein the computer program is executed by the processor to enable the processor to: acquire a background region in the reference image other than the object region; when the plurality of the pixel blocks are located in the object region, increase a distortion weight value in a preset cost parameter to obtain a cost parameter corresponding to the plurality of the pixel blocks; and when the plurality of the pixel blocks are located in the background region, decrease a bit rate weight value in the preset cost parameter to obtain a cost parameter corresponding to the plurality of the pixel blocks.
13. The electronic device according to claim 12, wherein the computer program is executed by the processor to enable the processor to: perform padding processing on the object region to obtain a transition region; and when the plurality of the pixel blocks are located in the transition region, determine the preset cost parameter to be a cost parameter corresponding to the plurality of the pixel blocks.
14. The electronic device according to claim 11, wherein the computer program is executed by the processor to enable the processor to: acquire a background region in the reference image other than the object region; and divide the object region into multiple first pixel blocks of a first size, and divide the background region into multiple second pixel blocks of a second size, wherein the first size is smaller than the second size.
15. The electronic device according to claim 11, wherein the computer program is executed by the processor to enable the processor to: after determining the set of coded data corresponding to the coding mode with the lowest coding cost as the target coded data for the plurality of the pixel blocks, perform transformation on the target coded data to obtain a one-dimensional array corresponding to the plurality of the pixel blocks; when the plurality of the pixel blocks are located in the object region, perform quantization on the one-dimensional array by use of a first step length; and when the plurality of the pixel blocks are located in a background region in the reference image other than the object region, perform quantization on the one-dimensional array by use of a second step length, wherein the first step length is less than the second step length.
16. The electronic device according to claim 11, wherein the reference image is a key frame image in a video stream, and the computer program is executed by the processor to enable the processor to: before acquiring the object region from the reference image, sequentially acquire each frame image in the video stream; recognize an object region in the frame image; and in a case that an object region in a present frame image is mismatched with an object region in a previous key frame image, determine the present frame image to be the reference image.
17. The electronic device according to claim 11, wherein the computer program is executed by the processor to enable the processor to: acquire the reference image; generate a central weight map corresponding to the reference image, wherein weight values represented by the central weight map gradually decrease from center to edge; input the reference image and the central weight map into an object detection model to obtain an object region confidence map; and determine an object in the reference image and acquire the object region in which the object is located, according to the object region confidence map.
18. The electronic device according to claim 17, wherein the computer program is executed by the processor to enable the processor to: process the object region confidence map to obtain an object mask pattern; detect the reference image to determine a bright region in the reference image; and determine the object in the reference image and acquire the object region in which the object is located, according to the bright region in the reference image and the object mask pattern.
19. The electronic device according to claim 17, wherein the computer program is executed by the processor to enable the processor to: obtain a region where each of multiple objects is located in the reference image and a category corresponding to each object according to the object region confidence map; determine an object based on a priority of a category and a size of a region, corresponding to each of the multiple objects; and determine a region where the object is located to be the object region.
20. A non-transitory computer-readable storage medium, in which a computer program is stored, wherein the computer program is executed by a processor to implement the following operations: acquiring an object region from a reference image; acquiring a plurality of pixel blocks forming the reference image; obtaining multiple sets of coded data for the plurality of the pixel blocks by coding each pixel block in multiple coding modes, each set of the coded data corresponding to a coding mode of the multiple coding modes; determining a cost parameter of the plurality of the pixel blocks based on a relative position relationship between the plurality of the pixel blocks and the object region; obtaining a coding cost in each of the multiple coding modes for the plurality of the pixel blocks based on the cost parameter of the plurality of the pixel blocks and the coded data in each coding mode; and determining a set of coded data corresponding to the coding mode with a lowest coding cost as the target coded data for the plurality of the pixel blocks.
</claims>
</document>
